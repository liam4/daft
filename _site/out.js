(function t(e,r,i){function n(s,o){if(!r[s]){if(!e[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return n(r?r:t)},h,h.exports,t,e,r,i)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<i.length;s++)n(i[s]);return n})({1:[function(t,e,r){(function(t){"use strict";var i=2e3;var n={s:1,n:0,d:1};function a(t,e){if(isNaN(t=parseInt(t,10))){s()}return t*e}function s(){throw"Invalid Param"}var o=function(t,e){var r=0,i=1,o=1;var u=0,l=0,h=0,c=1,f=1;var v=0,d=1;var p=1,g=1;var y=1e7;var b;if(t===undefined||t===null){}else if(e!==undefined){r=t;i=e;o=r*i}else switch(typeof t){case"object":{if("d"in t&&"n"in t){r=t["n"];i=t["d"];if("s"in t)r*=t["s"]}else if(0 in t){r=t[0];if(1 in t)i=t[1]}else{s()}o=r*i;break}case"number":{if(t<0){o=t;t=-t}if(t%1===0){r=t}else if(t>0){if(t>=1){f=Math.pow(10,Math.floor(1+Math.log(t)/Math.LN10));t/=f}while(d<=y&&g<=y){b=(v+p)/(d+g);if(t===b){if(d+g<=y){r=v+p;i=d+g}else if(g>d){r=p;i=g}else{r=v;i=d}break}else{if(t>b){v+=p;d+=g}else{p+=v;g+=d}if(d>y){r=p;i=g}else{r=v;i=d}}}r*=f}else if(isNaN(t)||isNaN(e)){i=r=NaN}break}case"string":{d=t.match(/\d+|./g);if(d[v]==="-"){o=-1;v++}else if(d[v]==="+"){v++}if(d.length===v+1){l=a(d[v++],o)}else if(d[v+1]==="."||d[v]==="."){if(d[v]!=="."){u=a(d[v++],o)}v++;if(v+1===d.length||d[v+1]==="("&&d[v+3]===")"||d[v+1]==="'"&&d[v+3]==="'"){l=a(d[v],o);c=Math.pow(10,d[v].length);v++}if(d[v]==="("&&d[v+2]===")"||d[v]==="'"&&d[v+2]==="'"){h=a(d[v+1],o);f=Math.pow(10,d[v+1].length)-1;v+=3}}else if(d[v+1]==="/"||d[v+1]===":"){l=a(d[v],o);c=a(d[v+2],1);v+=3}else if(d[v+3]==="/"&&d[v+1]===" "){u=a(d[v],o);l=a(d[v+2],o);c=a(d[v+4],1);v+=5}if(d.length<=v){i=c*f;o=r=h+i*u+f*l;break}}default:s()}if(i===0){throw"DIV/0"}n["s"]=o<0?-1:1;n["n"]=Math.abs(r);n["d"]=Math.abs(i)};var u=function(t,e,r){for(var i=1;e>0;t=t*t%r,e>>=1){if(e&1){i=i*t%r}}return i};var l=function(t,e){for(;e%2===0;e/=2){}for(;e%5===0;e/=5){}if(e===1)return 0;var r=10%e;for(var n=1;r!==1;n++){r=r*10%e;if(n>i)return 0}return n};var h=function(t,e,r){var i=1;var n=u(10,r,e);for(var a=0;a<300;a++){if(i===n)return a;i=i*10%e;n=n*10%e}return 0};var c=function(t,e){if(!t)return e;if(!e)return t;while(1){t%=e;if(!t)return e;e%=t;if(!e)return t}};function f(t,e){if(!(this instanceof f)){return new f(t,e)}o(t,e);if(f["REDUCE"]){t=c(n["d"],n["n"])}else{t=1}this["s"]=n["s"];this["n"]=n["n"]/t;this["d"]=n["d"]/t}f["REDUCE"]=1;f.prototype={s:1,n:0,d:1,abs:function(){return new f(this["n"],this["d"])},neg:function(){return new f(-this["s"]*this["n"],this["d"])},add:function(t,e){o(t,e);return new f(this["s"]*this["n"]*n["d"]+n["s"]*this["d"]*n["n"],this["d"]*n["d"])},sub:function(t,e){o(t,e);return new f(this["s"]*this["n"]*n["d"]-n["s"]*this["d"]*n["n"],this["d"]*n["d"])},mul:function(t,e){o(t,e);return new f(this["s"]*n["s"]*this["n"]*n["n"],this["d"]*n["d"])},div:function(t,e){o(t,e);return new f(this["s"]*n["s"]*this["n"]*n["d"],this["d"]*n["n"])},clone:function(){return new f(this)},mod:function(t,e){if(isNaN(this["n"])||isNaN(this["d"])){return new f(NaN)}if(t===undefined){return new f(this["s"]*this["n"]%this["d"],1)}o(t,e);if(0===n["n"]&&0===this["d"]){f(0,0)}return new f(this["s"]*n["d"]*this["n"]%(n["n"]*this["d"]),n["d"]*this["d"])},gcd:function(t,e){o(t,e);return new f(c(n["n"],this["n"]),n["d"]*this["d"]/c(n["d"],this["d"]))},lcm:function(t,e){o(t,e);if(n["n"]===0&&this["n"]===0){return new f}return new f(n["n"]*this["n"]/c(n["n"],this["n"]),c(n["d"],this["d"]))},ceil:function(t){t=Math.pow(10,t||0);if(isNaN(this["n"])||isNaN(this["d"])){return new f(NaN)}return new f(Math.ceil(t*this["s"]*this["n"]/this["d"]),t)},floor:function(t){t=Math.pow(10,t||0);if(isNaN(this["n"])||isNaN(this["d"])){return new f(NaN)}return new f(Math.floor(t*this["s"]*this["n"]/this["d"]),t)},round:function(t){t=Math.pow(10,t||0);if(isNaN(this["n"])||isNaN(this["d"])){return new f(NaN)}return new f(Math.round(t*this["s"]*this["n"]/this["d"]),t)},inverse:function(){return new f(this["s"]*this["d"],this["n"])},pow:function(t){if(t<0){return new f(Math.pow(this["s"]*this["d"],-t),Math.pow(this["n"],-t))}else{return new f(Math.pow(this["s"]*this["n"],t),Math.pow(this["d"],t))}},equals:function(t,e){o(t,e);return this["s"]*this["n"]*n["d"]===n["s"]*n["n"]*this["d"]},compare:function(t,e){o(t,e);var r=this["s"]*this["n"]*n["d"]-n["s"]*n["n"]*this["d"];return(0<r)-(r<0)},divisible:function(t,e){o(t,e);return!(!(n["n"]*this["d"])||this["n"]*n["d"]%(n["n"]*this["d"]))},valueOf:function(){return this["s"]*this["n"]/this["d"]},toFraction:function(t){var e,r="";var i=this["n"];var n=this["d"];if(this["s"]<0){r+="-"}if(n===1){r+=i}else{if(t&&(e=Math.floor(i/n))>0){r+=e;r+=" ";i%=n}r+=i;r+="/";r+=n}return r},toLatex:function(t){var e,r="";var i=this["n"];var n=this["d"];if(this["s"]<0){r+="-"}if(n===1){r+=i}else{if(t&&(e=Math.floor(i/n))>0){r+=e;i%=n}r+="\\frac{";r+=i;r+="}{";r+=n;r+="}"}return r},toContinued:function(){var t;var e=this["n"];var r=this["d"];var i=[];do{i.push(Math.floor(e/r));t=e%r;e=r;r=t}while(e!==1);return i},toString:function(){var t;var e=this["n"];var r=this["d"];if(isNaN(e)||isNaN(r)){return"NaN"}if(!f["REDUCE"]){t=c(e,r);e/=t;r/=t}var i=String(e).split("");var n=0;var a=[~this["s"]?"":"-","",""];var s="";var o=l(e,r);var u=h(e,r,o);var v=-1;var d=1;var p=15+o+u+i.length;for(var g=0;g<p;g++,n*=10){if(g<i.length){n+=Number(i[g])}else{d=2;v++}if(o>0){if(v===u){a[d]+=s+"(";s=""}else if(v===o+u){a[d]+=s+")";break}}if(n>=r){a[d]+=s+(n/r|0);s="";n=n%r}else if(d>1){s+="0"}else if(a[d]){a[d]+="0"}}a[0]+=a[1]||"0";if(a[2]){return a[0]+"."+a[2]}return a[0]}};if(typeof define==="function"&&define["amd"]){define([],function(){return f})}else if(typeof r==="object"){e["exports"]=f}else{t["Fraction"]=f}})(this)},{}],2:[function(t,e,r){(function(t){"use strict";if(Math.trunc==undefined){Math.trunc=function(t){return t<0?0-Math.floor(0-t):Math.floor(t)}}if((-2147483649).toString(16)==="-0"){var e=Number.prototype.toString;Number.prototype.toString=function(t){"use strict";return(this<0?"-":"")+e.call(this<0?0-this:this,t)}}var r=function(t,e,r,i){var n=e-1;var a=0;var s=i<10?i:10;while(++n<r){var o=t.charCodeAt(n);var u=o-48;if(u<0||s<=u){u=10-65+o;if(u<10||i<=u){u=10-97+o;if(u<10||i<=u){throw new RangeError}}}a=a*i+u}return a};var i=function(t){var e=new Array(t);var r=-1;while(++r<t){e[r]=0}return e};var n=function(t,e){var r=1;var i=t;var n=e;while(n>1){var a=Math.trunc(n/2);if(a*2!==n){r*=i}i*=i;n=a}return r*i};var a=function(t){return t(t,1/4503599627370496)}(function(t,e){return 1+e/2!==1?t(t,e/2):e});var s=2/a;var o=67108864*n(2,Math.trunc((Math.trunc(Math.log(s)/Math.log(2)+.5)-53)/2)+1)+1;var u=function(t){var e=t-s+s;return e>t?e-1:e};var l=function(t,e,r){var i=o*e;var n=i-(i-e);var a=e-n;var l=o*r;var h=l-(l-r);var c=r-h;var f=e*r;var v=n*h-f+n*c+a*h+a*c;var d=u(f/s);var p=f-d*s+v;if(p<0){p+=s;d-=1}p+=t-s;if(p<0){p+=s}else{d+=1}return{lo:p,hi:d}};var h=function(t,e,r){if(t>=r){throw new RangeError}var i=t*s;var n=i/r;var a=i%r;var o=u(n);if(n===o&&a>r-a){o-=1}a+=e-r;if(a<0){a+=r}else{o+=1}n=u(a/r);a-=n*r;o+=n;return{q:o,r:a}};function c(t,e,r,i){this.sign=t;this.magnitude=e;this.length=r;this.value=i}var f=function(t,e,r,i){return r===0?0:r===1?t===1?0-i:i:new c(t,e,r,i)};var v=function(t){if(typeof t==="number"){return new c(t<0?1:0,undefined,t===0?0:1,t<0?0-t:0+t)}return t};var d=function(t,e){if(e===undefined){e=10}if(Math.trunc(e)!==e||!(e>=2&&e<=36)){throw new RangeError("radix argument must be an integer between 2 and 36")}var a=t.length;if(a===0){throw new RangeError}var o=0;var h=t.charCodeAt(0);var c=0;if(h===43){c=1}if(h===45){c=1;o=1}a-=c;if(a===0){throw new RangeError}if(n(e,a)<=s){var v=r(t,c,c+a,e);return f(v===0?0:o,undefined,v===0?0:1,v)}var d=0;var p=1;var g=u(s/e);while(p<=g){d+=1;p*=e}var y=Math.trunc((a-1)/d)+1;var b=i(y);var m=y;var w=a;while(w>0){m-=1;b[m]=r(t,c+(w>d?w-d:0),c+w,e);w-=d}var k=-1;while(++k<y){var x=b[k];var S=-1;while(++S<k){var O=l(x,b[S],p);var C=O.lo;var F=O.hi;b[S]=C;x=F}b[k]=x}while(y>0&&b[y-1]===0){y-=1}return f(y===0?0:o,b,y,b[0])};var p=function(t,e){if(t.length!==e.length){return t.length<e.length?-1:+1}var r=t.length;while(--r>=0){if((t.magnitude===undefined?t.value:t.magnitude[r])!==(e.magnitude===undefined?e.value:e.magnitude[r])){return(t.magnitude===undefined?t.value:t.magnitude[r])<(e.magnitude===undefined?e.value:e.magnitude[r])?-1:+1}}return 0};var g=function(t,e){var r=v(t);var i=v(e);var n=r.sign===i.sign?p(r,i):1;return r.sign===1?0-n:n};var y=function(t,e,r){var n=v(t);var a=v(e);var o=p(n,a);var u=o<0?n.sign:r?1-a.sign:a.sign;var l=o<0?n.magnitude:a.magnitude;var h=o<0?n.length:a.length;var c=o<0?n.value:a.value;var d=o<0?r?1-a.sign:a.sign:n.sign;var g=o<0?a.magnitude:n.magnitude;var y=o<0?a.length:n.length;var b=o<0?a.value:n.value;if(h===0){return f(d,g,y,b)}var m=0;var w=y;if(u!==d){m=1;if(h===w){while(w>0&&(l===undefined?c:l[w-1])===(g===undefined?b:g[w-1])){w-=1}}if(w===0){return f(0,i(0),0,0)}}var k=i(w+(1-m));var x=-1;var S=0;while(++x<w){var O=x<h?l===undefined?c:l[x]:0;S+=(g===undefined?b:g[x])+(m===1?0-O:O-s);if(S<0){k[x]=s+S;S=0-m}else{k[x]=S;S=1-m}}if(S!==0){k[w]=S;w+=1}while(w>0&&k[w-1]===0){w-=1}return f(d,k,w,k[0])};var b=function(t,e){var r=v(t);var n=v(e);if(r.length===0||n.length===0){return f(0,i(0),0,0)}var a=r.sign===1?1-n.sign:n.sign;if(r.length===1&&(r.magnitude===undefined?r.value:r.magnitude[0])===1){return f(a,n.magnitude,n.length,n.value)}if(n.length===1&&(n.magnitude===undefined?n.value:n.magnitude[0])===1){return f(a,r.magnitude,r.length,r.value)}var o=r.length+n.length;var u=i(o);var h=-1;while(++h<n.length){var c=0;var d=-1;while(++d<r.length){var p=0;c+=u[d+h]-s;if(c>=0){p=1}else{c+=s}var g=l(c,r.magnitude===undefined?r.value:r.magnitude[d],n.magnitude===undefined?n.value:n.magnitude[h]);var y=g.lo;var b=g.hi;u[d+h]=y;c=b+p}u[r.length+h]=c}while(o>0&&u[o-1]===0){o-=1}return f(a,u,o,u[0])};var m=function(t,e,r){var n=v(t);var a=v(e);if(a.length===0){throw new RangeError}if(n.length===0){return f(0,i(0),0,0)}var o=n.sign===1?1-a.sign:a.sign;if(a.length===1&&(a.magnitude===undefined?a.value:a.magnitude[0])===1){if(r===1){return f(o,n.magnitude,n.length,n.value)}return f(0,i(0),0,0)}var c=n.length+1;var d=i(c+a.length+1);var p=d;var g=d;var y=-1;while(++y<n.length){g[y]=n.magnitude===undefined?n.value:n.magnitude[y]}var b=-1;while(++b<a.length){p[c+b]=a.magnitude===undefined?a.value:a.magnitude[b]}var m=p[c+a.length-1];var w=1;if(a.length>1){w=u(s/(m+1));if(w>1){var k=0;var x=-1;while(++x<c+a.length){var S=l(k,d[x],w);var O=S.lo;var C=S.hi;d[x]=O;k=C}d[c+a.length]=k;m=p[c+a.length-1]}if(m<u(s/2)){throw new RangeError}}var F=n.length-a.length+1;if(F<0){F=0}var E=undefined;var T=0;var _=F;while(--_>=0){var P=a.length+_;var I=s-1;if(g[P]!==m){var M=h(g[P],g[P-1],m);var A=M.q;var j=M.r;I=A}var R=0;var B=0;var D=_-1;while(++D<=P){var L=g[D];var N=l(B,I,p[c+D-_]);var Y=N.lo;var X=N.hi;g[D]=Y;B=X;R+=L-g[D];if(R<0){g[D]=s+R;R=-1}else{g[D]=R;R=0}}while(R!==0){I-=1;var H=0;var q=_-1;while(++q<=P){H+=g[q]-s+p[c+q-_];if(H<0){g[q]=s+H;H=0}else{g[q]=H;H=+1}}R+=H}if(r===1&&I!==0){if(T===0){T=_+1;E=i(T)}E[_]=I}}if(r===1){if(T===0){return f(0,i(0),0,0)}return f(o,E,T,E[0])}var z=n.length+1;if(w>1){var W=0;var U=z;while(--U>=0){var J=h(W,g[U],w);var V=J.q;var K=J.r;g[U]=V;W=K}if(W!==0){throw new RangeError}}while(z>0&&g[z-1]===0){z-=1}if(z===0){return f(0,i(0),0,0)}var $=i(z);var Z=-1;while(++Z<z){$[Z]=g[Z]}return f(n.sign,$,z,$[0])};var w=function(t){var e=v(t);return f(1-e.sign,e.magnitude,e.length,e.value)};var k=function(t,e,r,n){var a=t===1?"-":"";var o=r;if(o===0){return"0"}if(o===1){a+=e[0].toString(n);return a}var l=0;var c=1;var f=u(s/n);while(c<=f){l+=1;c*=n}if(c*n<=s){throw new RangeError}var v=o+Math.trunc((o-1)/l)+1;var d=i(v);var p=-1;while(++p<o){d[p]=e[p]}var g=v;while(o!==0){var y=0;var b=o;while(--b>=0){var m=h(y,d[b],c);var w=m.q;var k=m.r;d[b]=w;y=k}while(o>0&&d[o-1]===0){o-=1}g-=1;d[g]=y}a+=d[g].toString(n);while(++g<v){var x=d[g].toString(n);var S=l-x.length;while(--S>=0){a+="0"}a+=x}return a};c.prototype.toString=function(t){if(t===undefined){t=10}if(Math.trunc(t)!==t||!(t>=2&&t<=36)){throw new RangeError("radix argument must be an integer between 2 and 36")}return k(this.sign,this.magnitude,this.length,t)};c.parseInt=d;c.compareTo=function(t,e){if(typeof t==="number"&&typeof e==="number"){return t<e?-1:e<t?+1:0}return g(t,e)};c.add=function(t,e){if(typeof t==="number"&&typeof e==="number"){var r=t+e;if(r>-s&&r<+s){return r}}return y(t,e,0)};c.subtract=function(t,e){if(typeof t==="number"&&typeof e==="number"){var r=t-e;if(r>-s&&r<+s){return r}}return y(t,e,1)};c.multiply=function(t,e){if(typeof t==="number"&&typeof e==="number"){var r=0+t*e;if(r>-s&&r<+s){return r}}return b(t,e)};c.divide=function(t,e){if(typeof t==="number"&&typeof e==="number"){if(0+e===0){throw new RangeError}return t<0?e<0?0+Math.floor((0-t)/(0-e)):0-Math.floor((0-t)/(0+e)):e<0?0-Math.floor((0+t)/(0-e)):0+Math.floor((0+t)/(0+e))}return m(t,e,1)};c.remainder=function(t,e){if(typeof t==="number"&&typeof e==="number"){if(0+e===0){throw new RangeError}return 0+t%e}return m(t,e,0)};c.negate=function(t){if(typeof t==="number"){return 0-t}return w(t)};t.BigInteger=c})(this)},{}],3:[function(t,e,r){(function(){var t=/^\s+/,r=/\s+$/,i=0,n=Math,a=n.round,s=n.min,o=n.max,u=n.random;function l(t,e){t=t?t:"";e=e||{};if(t instanceof l){return t}if(!(this instanceof l)){return new l(t,e)}var r=h(t);this._originalInput=t,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=a(100*this._a)/100,this._format=e.format||r.format;this._gradientType=e.gradientType;if(this._r<1){this._r=a(this._r)}if(this._g<1){this._g=a(this._g)}if(this._b<1){this._b=a(this._b)}this._ok=r.ok;this._tc_id=i++}l.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function(){var t=this.toRgb();var e,r,i,n,a,s;e=t.r/255;r=t.g/255;i=t.b/255;if(e<=.03928){n=e/12.92}else{n=Math.pow((e+.055)/1.055,2.4)}if(r<=.03928){a=r/12.92}else{a=Math.pow((r+.055)/1.055,2.4)}if(i<=.03928){s=i/12.92}else{s=Math.pow((i+.055)/1.055,2.4)}return.2126*n+.7152*a+.0722*s},setAlpha:function(t){this._a=j(t);this._roundA=a(100*this._a)/100;return this},toHsv:function(){var t=d(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=d(this._r,this._g,this._b);var e=a(t.h*360),r=a(t.s*100),i=a(t.v*100);return this._a==1?"hsv("+e+", "+r+"%, "+i+"%)":"hsva("+e+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var t=f(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=f(this._r,this._g,this._b);var e=a(t.h*360),r=a(t.s*100),i=a(t.l*100);return this._a==1?"hsl("+e+", "+r+"%, "+i+"%)":"hsla("+e+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(t){return g(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(){return y(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:a(this._r),g:a(this._g),b:a(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+a(this._r)+", "+a(this._g)+", "+a(this._b)+")":"rgba("+a(this._r)+", "+a(this._g)+", "+a(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:a(R(this._r,255)*100)+"%",g:a(R(this._g,255)*100)+"%",b:a(R(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+a(R(this._r,255)*100)+"%, "+a(R(this._g,255)*100)+"%, "+a(R(this._b,255)*100)+"%)":"rgba("+a(R(this._r,255)*100)+"%, "+a(R(this._g,255)*100)+"%, "+a(R(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){if(this._a===0){return"transparent"}if(this._a<1){return false}return M[g(this._r,this._g,this._b,true)]||false},toFilter:function(t){var e="#"+y(this._r,this._g,this._b,this._a);var r=e;var i=this._gradientType?"GradientType = 1, ":"";if(t){var n=l(t);r=n.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+e+",endColorstr="+r+")"},toString:function(t){var e=!!t;t=t||this._format;var r=false;var i=this._a<1&&this._a>=0;var n=!e&&i&&(t==="hex"||t==="hex6"||t==="hex3"||t==="name");if(n){if(t==="name"&&this._a===0){return this.toName()}return this.toRgbString()}if(t==="rgb"){r=this.toRgbString()}if(t==="prgb"){r=this.toPercentageRgbString()}if(t==="hex"||t==="hex6"){r=this.toHexString()}if(t==="hex3"){r=this.toHexString(true)}if(t==="hex8"){r=this.toHex8String()}if(t==="name"){r=this.toName()}if(t==="hsl"){r=this.toHslString()}if(t==="hsv"){r=this.toHsvString()}return r||this.toHexString()},clone:function(){return l(this.toString())},_applyModification:function(t,e){var r=t.apply(null,[this].concat([].slice.call(e)));this._r=r._r;this._g=r._g;this._b=r._b;this.setAlpha(r._a);return this},lighten:function(){return this._applyModification(k,arguments)},brighten:function(){return this._applyModification(x,arguments)},darken:function(){return this._applyModification(S,arguments)},desaturate:function(){return this._applyModification(b,arguments)},saturate:function(){return this._applyModification(m,arguments)},greyscale:function(){return this._applyModification(w,arguments)},spin:function(){return this._applyModification(O,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(_,arguments)},complement:function(){return this._applyCombination(C,arguments)},monochromatic:function(){return this._applyCombination(P,arguments)},splitcomplement:function(){return this._applyCombination(T,arguments)},triad:function(){return this._applyCombination(F,arguments)},tetrad:function(){return this._applyCombination(E,arguments)}};l.fromRatio=function(t,e){if(typeof t=="object"){var r={};for(var i in t){if(t.hasOwnProperty(i)){if(i==="a"){r[i]=t[i]}else{r[i]=X(t[i])}}}t=r}return l(t,e)};function h(t){var e={r:0,g:0,b:0};var r=1;var i=false;var n=false;if(typeof t=="string"){t=W(t)}if(typeof t=="object"){if(t.hasOwnProperty("r")&&t.hasOwnProperty("g")&&t.hasOwnProperty("b")){e=c(t.r,t.g,t.b);i=true;n=String(t.r).substr(-1)==="%"?"prgb":"rgb"}else if(t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("v")){t.s=X(t.s);t.v=X(t.v);e=p(t.h,t.s,t.v);i=true;n="hsv"}else if(t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("l")){t.s=X(t.s);t.l=X(t.l);e=v(t.h,t.s,t.l);i=true;n="hsl"}if(t.hasOwnProperty("a")){r=t.a}}r=j(r);return{ok:i,format:t.format||n,r:s(255,o(e.r,0)),g:s(255,o(e.g,0)),b:s(255,o(e.b,0)),a:r}}function c(t,e,r){return{r:R(t,255)*255,g:R(e,255)*255,b:R(r,255)*255}}function f(t,e,r){t=R(t,255);e=R(e,255);r=R(r,255);var i=o(t,e,r),n=s(t,e,r);var a,u,l=(i+n)/2;if(i==n){a=u=0}else{var h=i-n;u=l>.5?h/(2-i-n):h/(i+n);switch(i){case t:a=(e-r)/h+(e<r?6:0);break;case e:a=(r-t)/h+2;break;case r:a=(t-e)/h+4;break}a/=6}return{h:a,s:u,l:l}}function v(t,e,r){var i,n,a;t=R(t,360);e=R(e,100);r=R(r,100);function s(t,e,r){if(r<0)r+=1;if(r>1)r-=1;if(r<1/6)return t+(e-t)*6*r;if(r<1/2)return e;if(r<2/3)return t+(e-t)*(2/3-r)*6;return t}if(e===0){i=n=a=r}else{var o=r<.5?r*(1+e):r+e-r*e;var u=2*r-o;i=s(u,o,t+1/3);n=s(u,o,t);a=s(u,o,t-1/3)}return{r:i*255,g:n*255,b:a*255}}function d(t,e,r){t=R(t,255);e=R(e,255);r=R(r,255);var i=o(t,e,r),n=s(t,e,r);var a,u,l=i;var h=i-n;u=i===0?0:h/i;if(i==n){a=0}else{switch(i){case t:a=(e-r)/h+(e<r?6:0);break;case e:a=(r-t)/h+2;break;case r:a=(t-e)/h+4;break}a/=6}return{h:a,s:u,v:l}}function p(t,e,r){t=R(t,360)*6;e=R(e,100);r=R(r,100);var i=n.floor(t),a=t-i,s=r*(1-e),o=r*(1-a*e),u=r*(1-(1-a)*e),l=i%6,h=[r,o,s,s,u,r][l],c=[u,r,r,o,s,s][l],f=[s,s,u,r,r,o][l];return{r:h*255,g:c*255,b:f*255}}function g(t,e,r,i){var n=[Y(a(t).toString(16)),Y(a(e).toString(16)),Y(a(r).toString(16))];if(i&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)){return n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0)}return n.join("")}function y(t,e,r,i){var n=[Y(H(i)),Y(a(t).toString(16)),Y(a(e).toString(16)),Y(a(r).toString(16))];return n.join("")}l.equals=function(t,e){if(!t||!e){return false}return l(t).toRgbString()==l(e).toRgbString()};l.random=function(){return l.fromRatio({r:u(),g:u(),b:u()})};function b(t,e){e=e===0?0:e||10;var r=l(t).toHsl();r.s-=e/100;r.s=B(r.s);return l(r)}function m(t,e){e=e===0?0:e||10;var r=l(t).toHsl();r.s+=e/100;r.s=B(r.s);return l(r)}function w(t){return l(t).desaturate(100)}function k(t,e){e=e===0?0:e||10;var r=l(t).toHsl();r.l+=e/100;r.l=B(r.l);return l(r)}function x(t,e){e=e===0?0:e||10;var r=l(t).toRgb();r.r=o(0,s(255,r.r-a(255*-(e/100))));r.g=o(0,s(255,r.g-a(255*-(e/100))));r.b=o(0,s(255,r.b-a(255*-(e/100))));return l(r)}function S(t,e){e=e===0?0:e||10;var r=l(t).toHsl();r.l-=e/100;r.l=B(r.l);return l(r)}function O(t,e){var r=l(t).toHsl();var i=(a(r.h)+e)%360;r.h=i<0?360+i:i;return l(r)}function C(t){var e=l(t).toHsl();e.h=(e.h+180)%360;return l(e)}function F(t){var e=l(t).toHsl();var r=e.h;return[l(t),l({h:(r+120)%360,s:e.s,l:e.l}),l({h:(r+240)%360,s:e.s,l:e.l})]}function E(t){var e=l(t).toHsl();var r=e.h;return[l(t),l({h:(r+90)%360,s:e.s,l:e.l}),l({h:(r+180)%360,s:e.s,l:e.l}),l({h:(r+270)%360,s:e.s,l:e.l})]}function T(t){var e=l(t).toHsl();var r=e.h;return[l(t),l({h:(r+72)%360,s:e.s,l:e.l}),l({h:(r+216)%360,s:e.s,l:e.l})]}function _(t,e,r){e=e||6;r=r||30;var i=l(t).toHsl();var n=360/r;var a=[l(t)];for(i.h=(i.h-(n*e>>1)+720)%360;--e;){i.h=(i.h+n)%360;a.push(l(i))}return a}function P(t,e){e=e||6;var r=l(t).toHsv();var i=r.h,n=r.s,a=r.v;var s=[];var o=1/e;while(e--){s.push(l({h:i,s:n,v:a}));a=(a+o)%1}return s}l.mix=function(t,e,r){r=r===0?0:r||50;var i=l(t).toRgb();var n=l(e).toRgb();var a=r/100;var s=a*2-1;var o=n.a-i.a;var u;if(s*o==-1){u=s}else{u=(s+o)/(1+s*o)}u=(u+1)/2;var h=1-u;var c={r:n.r*u+i.r*h,g:n.g*u+i.g*h,b:n.b*u+i.b*h,a:n.a*a+i.a*(1-a)};return l(c)};l.readability=function(t,e){var r=l(t);var i=l(e);return(Math.max(r.getLuminance(),i.getLuminance())+.05)/(Math.min(r.getLuminance(),i.getLuminance())+.05)};l.isReadable=function(t,e,r){var i=l.readability(t,e);var n,a;a=false;n=U(r);switch(n.level+n.size){case"AAsmall":case"AAAlarge":a=i>=4.5;break;case"AAlarge":a=i>=3;break;case"AAAsmall":a=i>=7;break}return a};l.mostReadable=function(t,e,r){var i=null;var n=0;var a;var s,o,u;r=r||{};s=r.includeFallbackColors;o=r.level;u=r.size;for(var h=0;h<e.length;h++){a=l.readability(t,e[h]);if(a>n){n=a;i=l(e[h])}}if(l.isReadable(t,i,{level:o,size:u})||!s){return i}else{r.includeFallbackColors=false;return l.mostReadable(t,["#fff","#000"],r)}};var I=l.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var M=l.hexNames=A(I);function A(t){var e={};for(var r in t){if(t.hasOwnProperty(r)){e[t[r]]=r}}return e}function j(t){t=parseFloat(t);if(isNaN(t)||t<0||t>1){t=1}return t}function R(t,e){if(L(t)){t="100%"}var r=N(t);t=s(e,o(0,parseFloat(t)));if(r){t=parseInt(t*e,10)/100}if(n.abs(t-e)<1e-6){return 1}return t%e/parseFloat(e)}function B(t){return s(1,o(0,t))}function D(t){return parseInt(t,16)}function L(t){return typeof t=="string"&&t.indexOf(".")!=-1&&parseFloat(t)===1}function N(t){return typeof t==="string"&&t.indexOf("%")!=-1}function Y(t){return t.length==1?"0"+t:""+t}function X(t){if(t<=1){t=t*100+"%"}return t}function H(t){return Math.round(parseFloat(t)*255).toString(16)}function q(t){return D(t)/255}var z=function(){var t="[-\\+]?\\d+%?";var e="[-\\+]?\\d*\\.\\d+%?";var r="(?:"+e+")|(?:"+t+")";var i="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";var n="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function W(e){e=e.replace(t,"").replace(r,"").toLowerCase();var i=false;if(I[e]){e=I[e];i=true}else if(e=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}var n;if(n=z.rgb.exec(e)){return{r:n[1],g:n[2],b:n[3]}}if(n=z.rgba.exec(e)){return{r:n[1],g:n[2],b:n[3],a:n[4]}}if(n=z.hsl.exec(e)){return{h:n[1],s:n[2],l:n[3]}}if(n=z.hsla.exec(e)){return{h:n[1],s:n[2],l:n[3],a:n[4]}}if(n=z.hsv.exec(e)){return{h:n[1],s:n[2],v:n[3]}}if(n=z.hsva.exec(e)){return{h:n[1],s:n[2],v:n[3],a:n[4]}}if(n=z.hex8.exec(e)){return{a:q(n[1]),r:D(n[2]),g:D(n[3]),b:D(n[4]),format:i?"name":"hex8"}}if(n=z.hex6.exec(e)){return{r:D(n[1]),g:D(n[2]),b:D(n[3]),format:i?"name":"hex"}}if(n=z.hex3.exec(e)){return{r:D(n[1]+""+n[1]),g:D(n[2]+""+n[2]),b:D(n[3]+""+n[3]),format:i?"name":"hex"}}return false}function U(t){var e,r;t=t||{level:"AA",size:"small"};e=(t.level||"AA").toUpperCase();r=(t.size||"small").toLowerCase();if(e!=="AA"&&e!=="AAA"){e="AA"}if(r!=="small"&&r!=="large"){r="small"}return{level:e,size:r}}if(typeof e!=="undefined"&&e.exports){e.exports=l}else if(typeof define==="function"&&define.amd){define(function(){return l})}else{window.tinycolor=l}})()},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,r,i){if(r)t(e.prototype,r);if(i)t(e,i);return e}}();function _classCallCheck(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var compile=function(){"use strict";var t;var e;t=true;e=true;var r;var i=function a(t){r[t]=(r[t]||0)+1};var n=function s(e,r){var n=function C(){return e.fns.length+w.length};var a=function F(){var t=n();w.push(b.length);return t};var s=0;var o=function E(){return"_tmp"+ ++s};var u=function T(t){b+="queue("+t+");\n";b+="return;\n"};var l=function _(t){var e=a();var r=o();if(t.isObservable){b+=r+" = "+t+".value\n";return r}if(t.thread){if(t.thread.isDone){b+=r+" = "+t+".thread.result\n";return r}}else{t.request()}t.thread.onFirstEmit(this.awake);return r};var h=function P(t){if(!t)return;for(var e=0;e<t.length;e++){y(t[e])}};var c=function I(t,e,r){var n;if(typeof t==="number"||typeof t==="boolean"){return""+t}else if(typeof t==="string"){return'"'+t.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/"/g,'\\"').replace(/\{/g,"\\x7b").replace(/\}/g,"\\x7d")+'"'}else{i("Undefined val: "+t[0])}};var f=/\d/;var v=function M(t){if(t[0]==="list:contains:"){return"listContains("+listRef(t[1])+", "+c(t[2])+")"}else if(t[0]==="<"||t[0]===">"){if(typeof t[1]==="string"&&f.test(t[1])||typeof t[1]==="number"){var e=t[0]==="<";var r=t[1];var i=t[2]}else if(typeof t[2]==="string"&&f.test(t[2])||typeof t[2]==="number"){var e=t[0]===">";var r=t[2];var i=t[1]}var n=+r;if(r==null||n!==n){return"(compare("+c(t[1])+", "+c(t[2])+") === "+(t[0]==="<"?-1:1)+")"}return(e?"numLess":"numGreater")+"("+n+", "+c(i)+")"}else if(t[0]==="="){if(typeof t[1]==="string"&&f.test(t[1])||typeof t[1]==="number"){var r=t[1];var i=t[2]}else if(typeof t[2]==="string"&&f.test(t[2])||typeof t[2]==="number"){var r=t[2];var i=t[1]}var n=+r;if(r==null||n!==n){return"(equal("+c(t[1])+", "+c(t[2])+"))"}return"(numEqual("+n+", "+c(i)+"))"}};var d=function A(t){if(typeof t==="boolean"){return t}if(typeof t==="number"||typeof t==="string"){return+t!==0&&t!==""&&t!=="false"&&t!==false}var e=v(t);return e!=null?e:"bool("+c(t,false,true)+")"};var p=function j(t){if(typeof t==="number"){return t||0}if(typeof t==="boolean"||typeof t==="string"){return+t||0}var e=numval(t);return e!=null?e:"(+"+c(t,true)+" || 0)"};var g=function R(t){b+="save();\n";b+="R.start = self.now();\n";b+="R.duration = "+t+";\n";b+="R.first = true;\n";var e=a();b+="if (self.now() - R.start < R.duration * 1000 || R.first) {\n";b+="  R.first = false;\n";u(e);b+="}\n";b+="restore();\n"};var y=function B(e){if(t){b+="console.log("+c(e[0])+");\n"}if(e[0]==="doBroadcastAndWait"){b+="save();\n";b+="R.threads = broadcast("+c(e[1])+");\n";b+="if (R.threads.indexOf(BASE) !== -1) return;\n";var r=a();b+="if (running(R.threads)) {\n";u(r);b+="}\n";b+="restore();\n"}else if(e[0]==="doForever"){var r=a();h(e[1]);u(r)}else if(e[0]==="doForeverIf"){var r=a();b+="if ("+d(e[1])+") {\n";h(e[2]);b+="}\n";u(r)}else if(e[0]==="doIf"){b+="if ("+d(e[1])+") {\n";h(e[2]);b+="}\n"}else if(e[0]==="doIfElse"){b+="if ("+d(e[1])+") {\n";h(e[2]);b+="} else {\n";h(e[3]);b+="}\n"}else if(e[0]==="doRepeat"){b+="save();\n";b+="R.count = "+p(e[1])+";\n";var r=a();b+="if (R.count >= 0.5) {\n";b+="  R.count -= 1;\n";h(e[2]);u(r);b+="} else {\n";b+="  restore();\n";b+="}\n"}else if(e[0]==="doReturn"){b+="endCall();\n";b+="return;\n"}else if(e[0]==="doUntil"){var r=a();b+="if (!"+d(e[1])+") {\n";h(e[2]);u(r);b+="}\n"}else if(e[0]==="doWhile"){var r=a();b+="if ("+d(e[1])+") {\n";

h(e[2]);u(r);b+="}\n"}else if(e[0]==="doWaitUntil"){var r=a();b+="if (!"+d(e[1])+") {\n";u(r);b+="}\n"}};var b="";var m=e.fns.length;var w=[0];for(var k=1;k<r.length;k++){y(r[k])}var x=function D(t){var e="(function() {\n";var r=0;var i=0;var n=false;var a=0;var s=t.length;while(a<s){var o=t.indexOf("{",a);var u=t.indexOf("}",a);if(o===-1&&u===-1){if(!n){e+=t.slice(a)}break}if(o===-1)o=s;if(u===-1)u=s;if(n){if(o<u){i++;a=o+1}else{i--;if(!i){n=false}a=u+1}}else{if(o<u){e+=t.slice(a,o+1);r++;a=o+1}else{e+=t.slice(a,u);a=u+1;if(t.substr(u,8)==="} else {"){if(r>0){e+="} else {";a=u+8}else{n=true;i=0}}else{if(r>0){e+="}";r--}}}}}e+="})";return runtime.scopedEval(e)};b+="if (true) {\n";var S=a();b+="lol();";b+="} else {\n";u(S);b+="}\n";for(var k=0;k<w.length;k++){e.fns.push(x(b.slice(w[k])))}var O=e.fns[m]};return function(t){r=Object.create(null);n(t,[]);for(var e in r){console.warn(e+(r[e]>1?" (repeated "+r[e]+" times)":""))}}}();exports.compile=compile;var runtime=function(){var self,S,R,STACK,C,WARP,CALLS,BASE,THREAD,IMMEDIATE;var bool=function t(e){return+e!==0&&e!==""&&e!=="false"&&e!==false};var mod=function e(t,r){var i=t%r;if(i/r<0){i+=r}return i};var mathFunc=function r(t,e){switch(t){case"abs":return Math.abs(e);case"floor":return Math.floor(e);case"sqrt":return Math.sqrt(e);case"ceiling":return Math.ceil(e);case"cos":return Math.cos(e*Math.PI/180);case"sin":return Math.sin(e*Math.PI/180);case"tan":return Math.tan(e*Math.PI/180);case"asin":return Math.asin(e)*180/Math.PI;case"acos":return Math.acos(e)*180/Math.PI;case"atan":return Math.atan(e)*180/Math.PI;case"ln":return Math.log(e);case"log":return Math.log(e)/Math.LN10;case"e ^":return Math.exp(e);case"10 ^":return Math.exp(e*Math.LN10)}return 0};var save=function i(){STACK.push(R);R={}};var restore=function n(){R=STACK.pop()};var call=function a(t,e,r){var i=S.procedures[t];if(i){STACK.push(R);CALLS.push(C);C={base:i.fn,fn:S.fns[e],args:r,numargs:[],boolargs:[],stack:STACK=[],warp:i.warp};R={};if(C.warp||WARP){WARP++;IMMEDIATE=i.fn}else{for(var n=CALLS.length,a=5;n--&&a--;){if(CALLS[n].base===i.fn){var s=true;break}}if(s){self.queue[THREAD]={sprite:S,base:BASE,fn:i.fn,calls:CALLS}}else{IMMEDIATE=i.fn}}}else{IMMEDIATE=S.fns[e]}};var endCall=function s(){if(CALLS.length){if(WARP)WARP--;IMMEDIATE=C.fn;C=CALLS.pop();STACK=C.stack;R=STACK.pop()}};var queue=function o(t){self.queue[THREAD]={sprite:S,base:BASE,fn:S.fns[t],calls:CALLS}};var Evaluator=function(){function t(){_classCallCheck(this,t)}_createClass(t,[{key:"initRuntime",value:function e(){this.queue=[];this.onError=this.onError.bind(this)}},{key:"startThread",value:function r(t,e){var r=new Thread(t,e);for(var i=0;i<this.queue.length;i++){var n=this.queue[i];if(n&&n.sprite===t&&n.base===e){this.queue[i]=r;return}}this.queue.push(r)}},{key:"stopThread",value:function i(t){var e=this.queue.indexOf(t);if(e!==-1){this.queue.splice(e,1)}}},{key:"start",value:function n(){this.isRunning=true;if(this.interval)return;addEventListener("error",this.onError);this.baseTime=Date.now();this.interval=setInterval(this.step.bind(this),1e3/this.framerate)}},{key:"pause",value:function a(){if(this.interval){this.baseNow=this.now();clearInterval(this.interval);delete this.interval;removeEventListener("error",this.onError)}this.isRunning=false}},{key:"stopAll",value:function s(){this.hidePrompt=false;this.prompter.style.display="none";this.promptId=this.nextPromptId=0;this.queue.length=0;this.resetFilters();this.stopSounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.isClone){e.remove();this.children.splice(t,1);t-=1}else if(e.isSprite){e.resetFilters();if(e.saying)e.say("");e.stopSounds()}}}},{key:"now",value:function o(){return this.baseNow+Date.now()-this.baseTime}},{key:"step",value:function u(){self=this;var t=Date.now();do{var e=this.queue;for(THREAD=0;THREAD<e.length;THREAD++){if(e[THREAD]){S=e[THREAD].sprite;IMMEDIATE=e[THREAD].fn;BASE=e[THREAD].base;CALLS=e[THREAD].calls;C=CALLS.pop();STACK=C.stack;R=STACK.pop();e[THREAD]=undefined;WARP=0;while(IMMEDIATE){var r=IMMEDIATE;IMMEDIATE=null;r()}STACK.push(R);CALLS.push(C)}}for(var i=e.length;i--;){if(!e[i])e.splice(i,1)}}while(Date.now()-t<1e3/this.framerate&&e.length);this.syncEmissions();S=null}},{key:"syncEmissions",value:function l(){}},{key:"onError",value:function h(t){clearInterval(this.interval)}},{key:"handleError",value:function c(t){console.error(t.stack)}},{key:"framerate",get:function f(){return 60}}]);return t}();var Thread=function(){function t(e,r,i){_classCallCheck(this,t);this.evaluator=e;this.sprite=r,this.base=i;this.fn=i;this.calls=[{args:[],stack:[{}]}];this.isRunning=true}_createClass(t,[{key:"stop",value:function e(){this.evaluator.stopThread(this);this.isRunning=false}}]);return t}();return{scopedEval:function scopedEval(source){return eval(source)}}}()},{}],5:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.Computed=r.Observable=r.evaluator=r.Evaluator=undefined;var i=function b(t,e,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,e);if(i===undefined){var n=Object.getPrototypeOf(t);if(n===null){return undefined}else{return b(n,e,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,r,i){if(r)t(e.prototype,r);if(i)t(e,i);return e}}();var a=t("./prims");var s=t("./events");function o(t,e){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e&&(typeof e==="object"||typeof e==="function")?e:t}function u(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof e)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(e)Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e}function l(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function h(t){if(!t)throw"Assertion failed!"}var c=r.Evaluator=function(){function t(e,r){var i=this;l(this,t);this.nodes={};e.forEach(function(t){return i.add(Node.fromJSON(t))});r.forEach(function(t){i.link(i.get(t.from),t.index,i.get(t.to))});e.forEach(function(t){if(t.isSink)t.request()});setInterval(this.tick.bind(this),1e3/60);this.queue=[]}n(t,[{key:"toJSON",value:function e(){var t=[];var e=[];this.nodes.forEach(function(r){t.push(r.toJSON());r.inputs.forEach(function(t,i){e.push({from:t.id,index:i,to:r})})});return{nodes:t,links:e}}},{key:"add",value:function r(t,e){if(this.nodes.hasOwnProperty(e))throw"oops";this.nodes[e]=t;t.id=e}},{key:"get",value:function i(t){return this.nodes[t]}},{key:"linkFromJSON",value:function s(t){return{from:this.get(t.from),index:t.index,to:this.get(t.to)}}},{key:"onMessage",value:function o(t){switch(t.action){case"link":var e=this.linkFromJSON(t);e.to.replaceArg(e.index,e.from);return;case"unlink":var e=this.linkFromJSON(t);e.to.replaceArg(e.index);return;case"setLiteral":var r=this.get(t.id);r.assign(t.literal);return;case"setSink":var r=this.get(t.id);r.isSink=t.isSink;return;case"create":var r=t.hasOwnProperty("literal")?new d(t.literal):new p(t.name);this.add(r,t.id);return;case"destroy":var r=this.get(t.id);this.remove(r);r.destroy();return;default:throw t}}},{key:"sendMessage",value:function u(t){}},{key:"emit",value:function h(t,e){var r="emit";var i=t.id;var n={action:r,id:i,value:e};this.sendMessage(n)}},{key:"progress",value:function c(t,e,r){var i="progress";var n=t.id;var a={action:i,id:n,loaded:e,total:r};this.sendMessage(a)}},{key:"getPrim",value:function f(t,e){var r=a.bySpec[t];if(!r){console.log("No prims for '"+t+"'");return{output:null,func:function o(){}}}var i=e.map(a.typeOf);var n=i.join(", ");var s=r[n];if(!s){if(r["Variadic"]){return r["Variadic"]}console.log("No prim for '"+t+"' inputs ["+n+"] matched "+Object.keys(r).join("; "));var s=v(r,e,i);if(s)return s;return{output:null,func:function u(){}}}return s}},{key:"schedule",value:function g(t){if(this.queue.indexOf(t)===-1){this.queue.push(t)}}},{key:"unschedule",value:function y(t){var e=this.queue.indexOf(t);if(e!==-1){this.queue.splice(e,1)}}},{key:"tick",value:function b(){var t=this.queue.slice();this.queue=[];for(var e=0;e<t.length;e++){var r=t[e];r()}}}],[{key:"fromJSON",value:function m(e){return new t(e.nodes,e.links)}}]);return t}();var f=r.evaluator=c.instance=new c([],[]);function v(t,e,r){var i=[];e.forEach(function(t,e){if(r[e]==="List"){if(t.isTask){h(t.isDone);t=t.result}r[e]=(0,a.typeOf)(t[0]);i.push(e)}});if(!i.length)return;var n=r.join(", ");var s=t[n];console.log(r);if(s){return{output:"List Future",func:function o(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++){e[r]=arguments[r]}var n=i.map(function(t){return e[t]});var a;for(var o=0;o<n.length;o++){var u=n[o];if(a===undefined){a=u.length}else{if(a!==u.length){this.emit(new Error("Lists must be same length"));return}}}var l=[];for(var o=0;o<a;o++){for(var h=0;h<i.length;h++){var c=i[h];e[c]=n[h][o]}l.push(g.fake(s,e.slice()))}this.awaitAll(l,function(){});this.emit(l)}}}}var d=r.Observable=function(){function t(e){l(this,t);this._value=e;this.subscribers=new Set}n(t,[{key:"assign",value:function e(t){t=t;this._value=t;var e={};this.subscribers.forEach(function(t){return t[0].invalidate(new Set)})}},{key:"request",value:function r(){return this._value}},{key:"subscribe",value:function i(t,e){this.subscribers.add([t,e]);this.update()}},{key:"unsubscribe",value:function a(t,e){this.subscribers.delete([t,e]);this.update()}},{key:"update",value:function s(){}},{key:"isObservable",get:function o(){return true}}]);return t}();var p=r.Computed=function(t){u(e,t);function e(t,r){l(this,e);var i=o(this,Object.getPrototypeOf(e).call(this));i.block=t;i.args=r=r||[];i.reprSubscriber=null;i.inputs=t.split(" ").filter(function(t){return t[0]==="%"});i._isSink=false;i._needed=false;i.thread=null;return i}n(e,[{key:"update",value:function r(){this.needed=this._isSink||!!this.subscribers.size}},{key:"assign",value:function a(t){throw"Computeds can't be assigned"}},{key:"_assign",value:function s(t){i(Object.getPrototypeOf(e.prototype),"assign",this).call(this,t)}},{key:"replaceArg",value:function h(t,e){var r=this.args[t];if(r)r.unsubscribe(this);if(e===undefined&&t===this.args.length-1){this.args.pop()}else{this.args[t]=e}if(e&&this.needed&&!this.inputs[t]!=="%u"){e.subscribe(this,t)}if(this.needed){this.invalidate(new Set)}if(e&&this.block==="display %s"){e.reprSubscriber=this}}},{key:"invalidate",value:function c(t){if(t.has(this))return;t.add(this);if(this.thread)this.thread.cancel();f.emit(this,null);if(this.needed){this.thread=new g(this);this.thread.start()}else{this.thread=null}this.subscribers.forEach(function(e){return e[0].invalidate(t)})}},{key:"invalidateChildren",value:function v(){var t=new Set;this.subscribers.forEach(function(e){return e[0].invalidate(t)})}},{key:"request",value:function d(){if(!this.thread)throw"oh dear";return this.thread}},{key:"isSink",get:function p(){return this._isSink},set:function y(t){if(this._isSink===t)return;this._isSink=t;this.update()}},{key:"needed",get:function b(){return this._needed},set:function m(t){var e=this;if(this._needed===t)return;this._needed=t;if(this.thread)this.thread.cancel();if(t){this.args.forEach(function(t,r){if(e.inputs[r]==="%u")return;t.subscribe(e,r)});this.thread=new g(this);this.thread.start()}else{this.thread=null;this.args.forEach(function(t,r){t.unsubscribe(e,r)})}}}]);return e}(d);var g=function(){function t(e){l(this,t);this.target=e;this.inputs=e?e.args:null;this.prim=null;this.isRunning=false;this.isDone=false;this.isStopped=false;this.waiting=[];this.result=null;this.loaded=0;this.total=null;this.lengthComputable=false;this.requests=[];this.evaluator=f}n(t,[{key:"toString",value:function e(){return"Future"}},{key:"start",value:function r(){var t=this;if(this.isStopped)throw"Can't resume stopped task";this.isRunning=true;var e=this.target.block;var r=function s(){t.prim=f.getPrim(e,n);t.schedule(i)};var i=function o(){var e=t.prim;var r=e.func;var i=n.map(function(e,r){if(!e||!e.isTask)return e;if(t.target.inputs[r]==="%u"){return e}return e.result});if(e.coercions){for(var a=0;a<e.coercions.length;a++){var s=e.coercions[a];if(s){i[a]=s(i[a])}}}var o=r.apply(t,i);if(!/Future/.test(e.output)){t.emit(o);t.isRunning=false}};var n=this.inputs.map(function(e,r){if(!e)return e;if(t.target.inputs[r]==="%u"){return e}return e.request()});var a=n.filter(function(t){return t&&t.isTask});this.awaitAll(a,r)}},{key:"schedule",value:function i(t){this.func=t;f.schedule(t)}},{key:"emit",value:function a(e){if(this.isStopped)return;this.isDone=true;this.result=e;this.dispatchEmit(e);if(this.target){f.emit(this.target,e);if(this.target.reprSubscriber&&!this.target.reprSubscriber.needed){var r=this.target.reprSubscriber;new t(r).start()}}}},{key:"withEmit",value:function s(t){if(this.isDone){t(this.result)}else{this.onEmit(t)}}},{key:"awaitAll",value:function o(t,e){var r=this;if(!e)throw"noo";t.forEach(function(t){if(r.waiting.indexOf(t)===-1){r.requests.push(t);if(!t.isDone)r.waiting.push(t);t.addEventListener("emit",r.signal.bind(r,t));t.addEventListener("progress",r.update.bind(r));r.update()}});this.func=e;if(!this.waiting.length){this.schedule(e);return}}},{key:"signal",value:function u(t){var e=this.waiting.indexOf(t);if(e===-1)return;this.waiting.splice(e,1);f.schedule(this.func)}},{key:"cancel",value:function h(){var t=this;this.waiting.forEach(function(e){e.removeEventListener(t)});this.isRunning=false;this.isStopped=true;f.unschedule(this.func)}},{key:"progress",value:function c(t,e,r){if(this.isStopped)return;this.loaded=t;this.total=e;this.lengthComputable=r;this.dispatchProgress({loaded:t,total:e,lengthComputable:r});if(this.target){f.progress(this.target,t,e)}}},{key:"update",value:function v(){if(this.isStopped)return;var t=this.requests;var e=t.length;var r=0;var i=0;var n=true;var a=0;var s=0;while(e--){var o=t[e];i+=o.loaded;if(o.isDone){r+=o.loaded;s+=1}else if(o.lengthComputable){r+=o.total}else{n=false;a+=1}}if(!n&&a!==t.length){var u=r/(t.length-a)*a;e=t.length;r=0;i=0;n=true;while(e--){var o=t[e];if(o.lengthComputable){i+=o.loaded;r+=o.total}else{r+=u;if(o.isDone)i+=u}}}this.progress(i,r,n)}},{key:"isTask",get:function d(){return true}}],[{key:"fake",value:function p(e,r){var i=new t(null);var n=r.filter(function(t){return t.isTask});i.awaitAll(n,a.bind(i));function a(){var t=e.func;var i=r.map(function(t,e){if(!t.isTask)return t;return t.result});if(e.coercions){for(var n=0;n<e.coercions.length;n++){var a=e.coercions[n];if(a){i[n]=a(i[n])}}}var s=t.apply(this,i);if(!/Future/.test(e.output)){this.emit(s);this.isRunning=false}}return i}}]);return t}();(0,s.addEvents)(g,"emit","progress");var y=function m(t){var e="";var r=new Set;var i=[];var n=function a(t){r.add(t);for(var e=0;e<t.inputs.length;e++){if(t[e].subscribers.length===1){a(t)}else if(r.has(t)){continue}i.push(t)}}}},{"./events":6,"./prims":8}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});var i=r.addEvents=function a(t){[].slice.call(arguments,1).forEach(function(e){n(t,e)})};var n=r.addEvent=function s(t,e){var r=e[0].toUpperCase()+e.substr(1);t.prototype.addEventListener=t.prototype.addEventListener||function(t,e){var r=this["$"+t]=this["$"+t]||[];r.push(e);return this};t.prototype.removeEventListener=t.prototype.removeEventListener||function(t,e){var r=this["$"+t];if(r){var i=r.indexOf(e);if(i!==-1){r.splice(i,1)}}return this};t.prototype.dispatchEvent=t.prototype.dispatchEvent||function(t,e){var r=this["$"+t];if(r){r.forEach(function(t){t(e)})}var i=this["on"+t];if(i){i(e)}return this};t.prototype["on"+r]=function(t){this.addEventListener(e,t);return this};t.prototype["dispatch"+r]=function(t){this.dispatchEvent(e,t);return this}}},{}],7:[function(t,e,r){"use strict";var i=function(){function t(t,e){var r=[];var i=true;var n=false;var a=undefined;try{for(var s=t[Symbol.iterator](),o;!(i=(o=s.next()).done);i=true){r.push(o.value);if(e&&r.length===e)break}}catch(u){n=true;a=u}finally{try{if(!i&&s["return"])s["return"]()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function vt(t,e,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,e);if(i===undefined){var n=Object.getPrototypeOf(t);if(n===null){return undefined}else{return vt(n,e,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,r,i){if(r)t(e.prototype,r);if(i)t(e,i);return e}}();var s=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol?"symbol":typeof t};var o=t("tinycolor2");var u=v(o);var l=t("./eval");var h=t("./compile");var c=t("./events");var f=t("./prims");function v(t){return t&&t.__esModule?t:{"default":t}}function d(t,e){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e&&(typeof e==="object"||typeof e==="function")?e:t}function p(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof e)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(e)Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e}function g(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var y=/Mac/i.test(navigator.userAgent);RegExp.escape=function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};function b(t){if(!t)throw"Assertion failed!"}function m(t,e){t=t||{};e=e||{};for(var r in t){if(t.hasOwnProperty(r)&&!e.hasOwnProperty(r)){e[r]=t[r]}}return e}function w(t){if(t==null)return t;if(t.constructor==Array){return t.map(w)}else if((typeof t==="undefined"?"undefined":s(t))=="object"){var e={};for(var r in t){e[w(r)]=w(t[r])}return e}else{return t}}function k(t,e){var r=document.createElement(e?t:"div");r.className=e||t||"";return r}var x=Math.PI*1/2;var S=Math.PI;var O=Math.PI*3/2;function C(t,e,r){return e>=0&&r>=0&&e<t.width&&r<t.height}function F(t,e,r){return C(t.canvas,e,r)&&t.getImageData(e,r,1,1).data[3]>0}function E(t,e,r,i,n){if(n==null)n=1;var a=i?-1:1;var s=t.canvas.width;var o=t.canvas.height;t.beginPath();e.call(r,t);t.fill();t.save();t.translate(-1e4,-1e4);t.beginPath();t.moveTo(-3,-3);t.lineTo(-3,o+3);t.lineTo(s+3,o+3);t.lineTo(s+3,-3);t.closePath();e.call(r,t);t.globalCompositeOperation="source-atop";t.shadowOffsetX=(1e4+a*-1)*n;t.shadowOffsetY=(1e4+a*-1)*n;t.shadowBlur=1.5*n;t.shadowColor="rgba(0, 0, 0, .7)";t.fill();t.shadowOffsetX=(1e4+a*1)*n;t.shadowOffsetY=(1e4+a*1)*n;t.shadowBlur=1.5*n;t.shadowColor="rgba(255, 255, 255, .4)";t.fill();t.restore()}window.compile=h.compile;l.evaluator.sendMessage=_;function T(t){l.evaluator.onMessage(t)}function _(t){switch(t.action){case"emit":P.byId[t.id].emit(t.value);return;case"progress":P.byId[t.id].progress(t.loaded,t.total);return}}var P=function(){function t(e,r,i,n){g(this,t);this.id=e||++t.highestId;this.name=r;this.literal=i||null;this.isSink=n||false;this.inputs=[];this.outputs=[];t.byId[this.id]=this}a(t,[{key:"destroy",value:function e(){var e=this;T({action:"destroy",id:this.id});delete t.byId[this.id];this.inputs.forEach(function(t){return e.removeInput(e.inputs.indexOf(t))});this.outputs.forEach(function(t){return t.removeInput(t.inputs.indexOf(e))})}},{key:"_addOutput",value:function r(t){if(this.outputs.indexOf(t)!==-1)return;this.outputs.push(t)}},{key:"_removeOutput",value:function i(t){var e=this.outputs.indexOf(t);if(e===-1)return;this.outputs.splice(e,1)}},{key:"addInput",value:function n(t,e){this.removeInput(t);this.inputs[t]=e;e._addOutput(this);T({action:"link",from:e.id,index:t,to:this.id})}},{key:"removeInput",value:function s(t){var e=this.inputs[t];if(e){e._removeOutput(this);T({action:"unlink",from:e.id,index:t,to:this.id})}this.inputs[t]=null}},{key:"setLiteral",value:function o(t){if(this.literal===t)return;this.literal=t;T({action:"setLiteral",id:this.id,literal:this.literal})}},{key:"setSink",value:function u(t){if(this.isSink===t)return;this.isSink=t;T({action:"setSink",id:this.id,isSink:this.isSink})}},{key:"emit",value:function l(t){this.value=t;this.dispatchEmit(t)}},{key:"progress",value:function h(t,e){this.dispatchProgress({loaded:t,total:e})}}],[{key:"input",value:function c(e){var r="literal _";var i=new t(null,r,e,false);T({action:"create",id:i.id,name:r,literal:e});return i}},{key:"block",value:function f(e){var r=new t(null,e,null,false);T({action:"create",id:r.id,name:e});return r}},{key:"repr",value:function v(e){var r="display %s";var v=new t(null,r,null,false);T({action:"create",id:v.id,name:r,isSink:false});v.addInput(0,e);return v}}]);return t}();P.highestId=0;P.byId={};(0,c.addEvents)(P,"emit","progress");var I=2;var M=k("metrics-container");document.body.appendChild(M);function A(t){var e=k("metrics "+t);var r=document.createTextNode("");e.appendChild(r);M.appendChild(e);var i=Object.create(null);return function n(t){if(hasOwnProperty.call(i,t)){return i[t]}r.data=t+"​";return i[t]={width:e.offsetWidth,height:e.offsetHeight}}}var j=function(){function t(){g(this,t);this.x=0;this.y=0;this.width=null;this.height=null;this.el=null;this.parent=null;this.dirty=true;this.graphicsDirty=true;this.lastTap=0;this._zoom=1}a(t,[{key:"moveTo",value:function e(t,r){this.x=t|0;this.y=r|0;this.transform()}},{key:"transform",value:function r(){var t="";t+="translate("+(this.x+(this._flip?1:0))+"px, "+this.y+"px)";if(this._zoom!==1)t+=" scale("+this._zoom+")";t+=" translateZ(0)";this.el.style.transform=t}},{key:"destroy",value:function i(){}},{key:"moved",value:function n(){}},{key:"layout",value:function s(){if(!this.parent)return;this.layoutSelf();this.parent.layout()}},{key:"layoutChildren",value:function o(){if(this.dirty){this.dirty=false;this.layoutSelf()}}},{key:"drawChildren",value:function u(){if(this.graphicsDirty){this.graphicsDirty=false;this.draw()}}},{key:"redraw",value:function l(){if(this.workspace){this.graphicsDirty=false;this.draw();this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"}else{this.graphicsDirty=true}}},{key:"click",value:function h(){this.lastTap=+new Date}},{key:"isDoubleTap",value:function c(){return+new Date-this.lastTap<400}},{key:"setHover",value:function f(t){}},{key:"setDragging",value:function v(t){}},{key:"zoom",set:function d(t){this._zoom=t;this.transform()}},{key:"app",get:function p(){var t=this;while(t&&!t.isApp){t=t.parent}return t}},{key:"workspace",get:function y(){var t=this;while(t&&!t.isWorkspace){t=t.parent}return t}},{key:"workspacePosition",get:function b(){var t=this;var e=0;var r=0;while(t&&!t.isWorkspace){e+=t.x;r+=t.y;t=t.parent}return{x:e,y:r}}},{key:"screenPosition",get:function m(){var t=this;var e=0;var r=0;while(t&&!t.isWorkspace&&!t.isApp){e+=t.x;r+=t.y;t=t.parent}if(t&&!t.isApp){return t.screenPositionOf(e,r)}return{x:e,y:r}}},{key:"topScript",get:function w(){var t=this;while(t.parent){if(t.parent.isWorkspace)return t;t=t.parent}return null}}]);return t}();var R=function(){function t(){g(this,t);this.el=k("frame");this.elContents=k("absolute frame-contents");this.el.appendChild(this.elContents);this.parent=null;this.scrollX=0;this.scrollY=0;this.zoom=1;this.lastX=0;this.lastY=0;this.inertiaX=0;this.inertiaY=0;this.scrolling=false;setInterval(this.tick.bind(this),1e3/60);this.contentsLeft=0;this.contentsTop=0;this.contentsRight=0;this.contentsBottom=0}a(t,[{key:"toScreen",value:function e(t,r){return{x:(t-this.scrollX)*this.zoom,y:(r-this.scrollY)*this.zoom}}},{key:"fromScreen",value:function r(t,e){return{x:t/this.zoom+this.scrollX,y:e/this.zoom+this.scrollY}}},{key:"resize",value:function i(){this.width=this.el.offsetWidth;this.height=this.el.offsetHeight;this.makeBounds();this.transform()}},{key:"scrollBy",value:function n(t,e){this.scrollX+=t/this.zoom;this.scrollY+=e/this.zoom;this.makeBounds();this.transform()}},{key:"fingerScroll",value:function s(t,e){if(!this.scrolling){this.inertiaX=0;this.inertiaY=0}this.scrollBy(-t,-e);this.scrolling=true}},{key:"fingerScrollEnd",value:function o(){this.scrolling=false}},{key:"tick",value:function u(){if(this.scrolling){this.inertiaX=(this.inertiaX*4+(this.scrollX-this.lastX))/5;this.inertiaY=(this.inertiaY*4+(this.scrollY-this.lastY))/5;this.lastX=this.scrollX;this.lastY=this.scrollY}else{if(this.inertiaX!==0||this.inertiaY!==0){this.scrollBy(this.inertiaX,this.inertiaY);this.inertiaX*=.95;this.inertiaY*=.95;if(Math.abs(this.inertiaX)<.01)this.inertiaX=0;if(Math.abs(this.inertiaY)<.01)this.inertiaY=0}}}},{key:"fixZoom",value:function l(t){return t}},{key:"zoomBy",value:function h(t,e,r){if(!this.isZoomable)return;var i=this.fromScreen(e,r);this.zoom*=t;this.zoom=this.fixZoom(this.zoom*t);this.makeBounds();var n=this.fromScreen(e,r);this.scrollX+=i.x-n.x;this.scrollY+=i.y-n.y;this.makeBounds();this.transform()}},{key:"canScroll",value:function c(t,e){if(this.isInfinite)return true;var r=this.scrollX+t;var i=this.scrollY+e;return this.contentsLeft<=r&&r<=this.contentsRight*this.zoom-this.width&&this.contentsTop<=i&&i<=this.contentsBottom*this.zoom-this.height}},{key:"makeBounds",value:function f(){if(!this.isInfinite){this.scrollX=Math.min(Math.max(this.scrollX,this.contentsLeft),Math.max(0,this.contentsRight*this.zoom-this.width));this.scrollY=Math.min(Math.max(this.scrollY,this.contentsTop),Math.max(0,this.contentsBottom*this.zoom-this.height));b(!isNaN(this.scrollY))}this.bounds={left:this.scrollX-this.width/2/this.zoom+.5|0,right:this.scrollX+this.width/2/this.zoom+.5|0,bottom:this.scrollY-this.height/2/this.zoom+.5|0,top:this.scrollY+this.height/2/this.zoom+.5|0}}},{key:"transform",value:function v(){this.elContents.style.transform="scale("+this.zoom+") translate("+-this.scrollX+"px, "+-this.scrollY+"px)"}},{key:"isScrollable",get:function d(){return true}},{key:"isZoomable",get:function p(){return false}}]);return t}();var B=function(t){p(e,t);function e(t){g(this,e);b(typeof t==="string");var r=d(this,Object.getPrototypeOf(e).call(this));r.el=k("absolute label");r.text=t;return r}a(e,[{key:"objectFromPoint",value:function r(t,e){return null}},{key:"copy",value:function i(){return new e(this.text)}},{key:"layoutSelf",value:function n(){}},{key:"draw",value:function s(){}},{key:"text",get:function o(){return this._text},set:function u(t){this._text=t;this.el.textContent=t;var r=e.measure(t);this.width=r.width;this.height=r.height*1.2|0;this.layout()}},{key:"dragObject",get:function l(){return this.parent.dragObject}}]);return e}(j);B.prototype.isLabel=true;B.measure=A("label");var D=function(t){p(e,t);function e(t,r){g(this,e);var i=d(this,Object.getPrototypeOf(e).call(this));i.el=k("absolute");i.el.appendChild(i.canvas=k("canvas","absolute"));i.context=i.canvas.getContext("2d");i.el.appendChild(i.field=k("input","absolute field text-field"));i.shape=r;i.field.addEventListener("input",i.change.bind(i));i.field.addEventListener("keydown",i.keyDown.bind(i));i.node=P.input(t);i.value=t;return i}a(e,[{key:"change",value:function r(t){this.value=this.field.value;this.layout();b(this.parent)}},{key:"keyDown",value:function i(t){}},{key:"copy",value:function s(){return new e(this._value,this.shape)}},{key:"replaceWith",value:function o(t){this.parent.replace(this,t)}},{key:"click",value:function l(){n(Object.getPrototypeOf(e.prototype),"click",this).call(this);if(this.shape==="Color"){this.field.focus();return}this.field.select();this.field.setSelectionRange(0,this.field.value.length)}},{key:"objectFromPoint",value:function h(t,e){return F(this.context,t*I,e*I)?this:null}},{key:"draw",value:function c(){this.canvas.width=this.width*I;this.canvas.height=this.height*I;this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.context.scale(I,I);this.drawOn(this.context)}},{key:"drawOn",value:function v(t){t.fillStyle=this.color;E(t,this.pathFn,this,true,I);if(this.pathIcon){t.save();t.fillStyle="rgba(255, 255, 255, 0.5)";this.pathIcon(t);t.closePath();t.fill();t.restore()}}},{key:"pathRounded",value:function y(t,e){var r=this.width;var i=this.height;var e=e!==undefined?e:4;t.moveTo(0,e+.5);t.arc(e,e+.5,e,S,O,false);t.arc(r-e,e+.5,e,O,0,false);t.arc(r-e,i-e-.5,e,0,x,false);t.arc(e,i-e-.5,e,x,S,false)}},{key:"pathCircle",value:function m(t){this.pathRounded(t,this.height/2)}},{key:"pathObj",value:function w(t){this.pathRounded(t,I*2)}},{key:"pathSquare",value:function C(t){this.pathRounded(t,I)}},{key:"pathTag",value:function T(t){var e=this.width;var r=this.height;var i=r/2;t.moveTo(0,0);t.lineTo(e-i,0);t.lineTo(e,i);t.lineTo(e-i,r);t.lineTo(0,r)}},{key:"pathRecordIcon",value:function _(t){var e=22/16;t.translate(0,1);t.scale(e,e);for(var r=0;r<=7;r+=7){t.moveTo(1,r+3);t.lineTo(4,r+3);t.lineTo(4,r+1.5);t.lineTo(7,r+4);t.lineTo(4,r+6.5);t.lineTo(4,r+5);t.lineTo(1,r+5);t.moveTo(9,r+2);t.lineTo(12.5,r+2);t.lineTo(15,r+2);t.lineTo(15,r+6);t.lineTo(9,r+6)}}},{key:"pathListIcon",value:function M(t){var e=22/16;t.scale(e,e);for(var r=4;r<=12;r+=4){t.moveTo(2,3);t.arc(3.5,r,1.5,0,2*Math.PI);t.rect(6.5,r-1,8,2)}}},{key:"layoutSelf",value:function A(){var t=false;if(this.shape==="Menu"||this.shape==="Record"||this.shape==="List"){var r=document.createElement("canvas");var i=r.getContext("2d");i.fillStyle=this.parent.color;i.fillRect(0,0,1,1);i.fillStyle="rgba(0,0,0, .15)";i.fillRect(0,0,1,1);var n=i.getImageData(0,0,1,1).data;var a=(n[0]*65536+n[1]*256+n[2]).toString(16);this.color="#"+"000000".slice(a.length)+a}else if(this.shape==="Color"){this.color=this.value;t=true}else{this.color="#f7f7f7"}var s=t?{width:12,height:20}:e.measure(this.field.value);this.height=s.height+3;var o=0;var u=0;if(this.pathFn===this.pathTag){u=this.height/2-4}var l=Math.max(this.height,Math.max(this.minWidth,s.width)+this.fieldPadding*2);this.width=l+o+u;this.field.className="absolute field text-field field-"+this.shape;this.field.type=t?"color":"";if(t){this.field.style.width=this.width+"px";this.field.style.height=this.height+"px";this.field.style.left="0"}else{this.field.style.width=l+"px";this.field.style.height=this.height+"px";this.field.style.left=o+"px"}this.redraw()}},{key:"pathShadowOn",value:function j(t){this.pathFn(t);t.closePath()}},{key:"isInput",get:function R(){return true}},{key:"isArg",get:function B(){return true}},{key:"isDraggable",get:function D(){return this.workspace&&this.workspace.isPalette}},{key:"dragObject",get:function L(){return this.parent.dragObject}},{key:"value",get:function N(){return this._value},set:function Y(t){t=""+t;this._value=t;if(this.field.value!==t){this.field.value=t}if(this.shape==="Color"){t=(0,u.default)(t)}else{t=(0,f.literal)(t)}this.node.setLiteral(t);this.layout()}},{key:"shape",get:function X(){return this._shape},set:function H(t){this._shape=t;this.color="#fff";this.pathIcon=null;switch(t){case"Num":this.pathFn=this.pathCircle;break;case"Menu":case"Color":this.pathFn=this.pathSquare;break;case"Symbol":this.pathFn=this.pathTag;break;case"List":this.pathFn=this.pathObj;this.pathIcon=this.pathListIcon;break;case"Record":this.pathFn=this.pathObj;this.pathIcon=this.pathRecordIcon;break;default:this.pathFn=this.pathRounded}}}]);return e}(j);D.measure=A("field");D.prototype.minWidth=8;D.prototype.fieldPadding=4;var L=function(t){p(e,t);function e(){g(this,e);
var t=d(this,Object.getPrototypeOf(e).call(this));t.el=k("br","");return t}a(e,[{key:"copy",value:function r(){return new e}},{key:"layoutSelf",value:function i(){}},{key:"draw",value:function n(){}},{key:"objectFromPoint",value:function s(){}},{key:"isBreak",get:function o(){return true}}]);return e}(j);var N=function(t){p(e,t);function e(t){g(this,e);var r=d(this,Object.getPrototypeOf(e).call(this));r.el=k("absolute switch");r.el.appendChild(r.canvas=k("canvas","absolute"));r.context=r.canvas.getContext("2d");r.knob=new Y(r);r.el.appendChild(r.knob.el);r.node=P.input(t);r.value=t;return r}a(e,[{key:"copy",value:function r(){return new e(this.value)}},{key:"replaceWith",value:function i(t){this.parent.replace(this,t)}},{key:"objectFromPoint",value:function s(t,e){return this.knob.objectFromPoint(t-this.knob.x,e-this.knob.y)||F(this.context,t*I,e*I)?this:null}},{key:"click",value:function o(){n(Object.getPrototypeOf(e.prototype),"click",this).call(this);this.value=!this.value}},{key:"layoutSelf",value:function u(){this.width=32;this.height=14;this.redraw()}},{key:"layoutChildren",value:function l(){this.knob.layout();this.layoutSelf()}},{key:"draw",value:function h(){this.canvas.width=this.width*I;this.canvas.height=this.height*I;this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.context.scale(I,I);this.drawOn(this.context)}},{key:"drawOn",value:function c(t){t.fillStyle=this.color;E(t,this.pathFn,this,true,I)}},{key:"pathFn",value:function f(t){var e=this.width;var r=this.height;var i=8;t.moveTo(0,i+.5);t.arc(i,i+.5,i,S,O,false);t.arc(e-i,i+.5,i,O,0,false);t.arc(e-i,r-i-.5,i,0,x,false);t.arc(i,r-i-.5,i,x,S,false)}},{key:"pathShadowOn",value:function v(t){this.pathFn(t);t.closePath()}},{key:"isSwitch",get:function y(){return true}},{key:"isArg",get:function b(){return true}},{key:"isDraggable",get:function m(){return true}},{key:"dragObject",get:function w(){return this.parent.dragObject}},{key:"value",get:function C(){return this._value},set:function T(t){if(this._value===t)return;this._value=t;this.node.setLiteral(t);this.knob.moveTo(this._value?32-20+3:-3,-2);this.color=this._value?"#64c864":"#b46464";this.redraw()}}]);return e}(j);var Y=function(t){p(e,t);function e(t){g(this,e);var r=d(this,Object.getPrototypeOf(e).call(this));r.parent=t;r.el=k("absolute switch-knob");r.el.appendChild(r.canvas=k("canvas","absolute"));r.context=r.canvas.getContext("2d");r.color="#bbc";r.layoutSelf();return r}a(e,[{key:"objectFromPoint",value:function r(t,e){return F(this.context,t*I,e*I)?this:null}},{key:"click",value:function i(){n(Object.getPrototypeOf(e.prototype),"click",this).call(this);this.parent.click()}},{key:"layoutSelf",value:function s(){this.width=20;this.height=20;this.redraw()}},{key:"draw",value:function o(){this.canvas.width=this.width*I;this.canvas.height=this.height*I;this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.context.scale(I,I);this.drawOn(this.context)}},{key:"drawOn",value:function u(t){t.fillStyle=this.color;E(t,this.pathFn,this,false,I)}},{key:"pathFn",value:function l(t){var e=this.width;var r=this.height;var i=10;t.moveTo(0,i+.5);t.arc(i,i+.5,i,S,O,false);t.arc(e-i,i+.5,i,O,0,false);t.arc(e-i,r-i-.5,i,0,x,false);t.arc(i,r-i-.5,i,x,S,false)}},{key:"isDraggable",get:function h(){return true}},{key:"dragObject",get:function c(){return this.parent.dragObject}}]);return e}(j);var X=function(t){p(e,t);function e(t,r){g(this,e);var i=d(this,Object.getPrototypeOf(e).call(this));i.icon=t;i.pathFn=t==="▶"?i.pathAddInput:t==="◀"?i.pathDelInput:b(false);i.action=r;i.el=k("absolute");i.el.appendChild(i.canvas=k("canvas","absolute"));i.context=i.canvas.getContext("2d");i.setHover(false);i.layoutSelf();return i}a(e,[{key:"objectFromPoint",value:function r(t,e){var r=4;var i=4;var n={width:this.width+r*3,height:this.height+i*3};if(C(n,t+r,e+i)){return this}}},{key:"setHover",value:function i(t){this.color=t?"#5B57C5":"#333"}},{key:"copy",value:function s(){return new e(this.icon,this.action)}},{key:"click",value:function o(){n(Object.getPrototypeOf(e.prototype),"click",this).call(this);this.action.call(this.parent)}},{key:"layoutSelf",value:function u(){this.width=14;this.height=14;this.redraw()}},{key:"draw",value:function l(){this.canvas.width=this.width*I;this.canvas.height=this.height*I;this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.context.scale(I,I);this.drawOn(this.context)}},{key:"drawOn",value:function h(t){t.strokeStyle=this.color;t.lineWidth=.5*I;this.pathFn(t);t.closePath();t.stroke()}},{key:"pathCircle",value:function c(t){var e=this.width;var r=this.height;var i=r/2;t.moveTo(0,i+1);t.arc(i,i+1,i,S,O,false);t.arc(e-i,i+1,i,O,0,false);t.arc(e-i,r-i-1,i,0,x,false);t.arc(i,r-i-1,i,x,S,false)}},{key:"pathDelInput",value:function f(t){var e=this.width;var r=this.height;var i=1.5*I;this.pathCircle(t);t.moveTo(i,r/2);t.lineTo(e-i,r/2)}},{key:"pathAddInput",value:function v(t){var e=this.width;var r=this.height;var i=1.5*I;this.pathCircle(t);t.moveTo(i,r/2);t.lineTo(e-i,r/2);t.moveTo(e/2,i);t.lineTo(e/2,r-i)}},{key:"isArrow",get:function y(){return true}},{key:"color",get:function m(){return this._color},set:function w(t){this._color=t;this.redraw()}},{key:"isDraggable",get:function F(){return true}},{key:"dragObject",get:function E(){return this.parent.dragObject}}]);return e}(j);var H=function(t){p(e,t);function e(t,r){g(this,e);var i=d(this,Object.getPrototypeOf(e).call(this));i.el=k("absolute");i.el.appendChild(i.canvas=k("canvas","absolute"));i.context=i.canvas.getContext("2d");i.parts=[];i.labels=[];i.args=[];i.node=P.block(t.spec);i.repr=P.repr(i.node);i.info=t;for(var n=0;n<r.length;n++){i.add(r[n])}i.inputs=i.parts.filter(function(t){return t.isArg});i.color=t.color;i.outputs=[];i.curves=[];i.blob=new rt(i);i.bubble=new z(i);i.el.appendChild(i.bubble.el);i.addOutput(i.bubble);i.bubble.parent=i;i.wrap=false;return i}a(e,[{key:"add",value:function r(t){this.insert(t,this.parts.length)}},{key:"insert",value:function i(t,e){b(t!==this);if(t.parent)t.parent.remove(t);t.parent=this;t.zoom=1;this.parts.splice(e,0,t);if(this.parent)t.layoutChildren();this.layout();this.el.appendChild(t.el);var r=t.isArg?this.args:this.labels;r.push(t);if(t.isArg){var e=r.length-1;this.node.addInput(e,t.node)}}},{key:"replace",value:function s(t,e){b(e!==this);if(t.parent!==this)return;if(e.parent)e.parent.remove(e);t.parent=null;e.parent=this;e.zoom=1;var r=this.parts.indexOf(t);this.parts.splice(r,1,e);var i=t.isArg?this.args:this.labels;var r=i.indexOf(t);i.splice(r,1,e);e.layoutChildren();e.redraw();this.layout();if(this.workspace)e.drawChildren();this.el.replaceChild(e.el,t.el);this.node.addInput(r,e.node)}},{key:"remove",value:function o(t){if(t.parent!==this)return;if(t.isBubble){if(this.bubble===t){this.removeBubble(t)}return}t.parent=null;var e=this.parts.indexOf(t);this.parts.splice(e,1);this.layout();this.el.removeChild(t.el);var r=t.isArg?this.args:this.labels;var e=r.indexOf(t);r.splice(e,1);this.node.removeInput(e)}},{key:"addOutput",value:function u(t){this.outputs.push(t);t.target=this;var e=new it(this,t);t.curve=e;this.curves.push(e);this.layoutBubble(t)}},{key:"removeOutput",value:function l(t){var e=this.outputs.indexOf(t);this.curves[e].destroy();this.outputs.splice(e,1);this.curves.splice(e,1);t.parent=null;if(e===0&&this.outputs.length===0){}}},{key:"addBubble",value:function h(t){b(t);b(this.bubble===this.blob);if(this.outputs.length>1){t.curve.parent.remove(t.curve);t.parent.remove(t);this.removeOutput(t);this.updateSinky();return}t.zoom=1;this.el.removeChild(this.blob.el);this.bubble=t;t.parent=this;this.el.appendChild(t.el);this.layoutBubble(t);this.updateSinky()}},{key:"removeBubble",value:function c(t){b(this.bubble===t);this.bubble=this.blob;this.el.appendChild(this.blob.el);this.blob.layoutSelf();this.layoutBubble(this.bubble);this.el.removeChild(t.el);this.updateSinky()}},{key:"reset",value:function f(t){if(t.parent!==this||t.isLabel)return this;b(t.isArg);var e=this.args.indexOf(t);this.replace(t,this.inputs[e])}},{key:"detach",value:function v(){if(this.isDoubleTap()){return this.copy()}if(this.workspace.isPalette){var t=this.copy();t.repr.setSink(true);return t}if(this.parent.isBlock){this.parent.reset(this)}return this}},{key:"copy",value:function y(){var t=this;var r=new e(this.info,this.parts.map(function(t){return t.copy()}));r.inputs=this.inputs.map(function(e){var i=t.parts.indexOf(e);if(i===-1){return e.copy()}return r.parts[i]});r.count=this.count;r.wrap=this.wrap;return r}},{key:"destroy",value:function m(){this.parts.forEach(function(t){return t.destroy()})}},{key:"replaceWith",value:function w(t){this.parent.replace(this,t)}},{key:"moveTo",value:function C(t,r){n(Object.getPrototypeOf(e.prototype),"moveTo",this).call(this,t,r);this.moved()}},{key:"moved",value:function T(){this.parts.forEach(function(t){return t.moved()});this.curves.forEach(function(t){return t.layoutSelf()})}},{key:"objectFromPoint",value:function _(t,e){if(this.bubble&&this.bubbleVisible){var r=this.bubble.objectFromPoint(t-this.bubble.x,e-this.bubble.y);if(r)return r}for(var i=this.parts.length;i--;){var n=this.parts[i];var r=n.objectFromPoint(t-n.x,e-n.y);if(r)return r}return F(this.context,t*I,e*I)?this:null}},{key:"layoutChildren",value:function M(){this.parts.forEach(function(t){return t.layoutChildren()});this.bubble.layoutChildren();if(this.dirty){this.dirty=false;this.layoutSelf()}}},{key:"drawChildren",value:function A(){this.parts.forEach(function(t){return t.drawChildren()});this.outputs.forEach(function(t){return t.drawChildren()});if(this.graphicsDirty){this.graphicsDirty=false;this.draw()}}},{key:"minDistance",value:function j(t){if(t.isSwitch){return 16}if(t.shape==="Color"){return 10}if(t.isBubble||t.isSource){return 0}if(t.isBlock){return 6}if(t.shape==="Symbol"){return 9}return-2+t.height/2|0}},{key:"layoutSelf",value:function R(){var t=4;var e=0;var r=0;var i=28;var n=[[]];var a=[[0]];var s=[28];var o=0;var u=this.parts;var l=u.length;var h=this.wrap;var c=false;for(var f=0;f<l;f++){var v=u[f];if(v instanceof L){c=true;if(!h)continue;if(s.length===1){s[0]-=4}o++;e=20;a.push([e]);n.push([]);s.push(0);continue}if(h&&v instanceof X){if(v.icon==="◀"){a[o][a[o].length-1]=2;n[o].push(v);e=0;continue}else if(v.icon==="▶"){o++;s.push(4);a.push([2]);n.push([v]);continue}}var d=this.minDistance(v);if(d&&e<d-t&&o===0){e=a[0][a[0].length-1]=d-t}e+=v.width;r=Math.max(r,e+Math.max(0,d-t));e+=4;a[o].push(e);var p=v.height+(v.isBubble?0:4);s[o]=Math.max(s[o],p);n[o].push(v)}r=Math.max(20,r+t*2);if(c&&!h&&r>512){this.wrap=true;this.layoutSelf();return}var g=0;for(var f=0;f<a.length;f++){var o=n[f];var y=s[f];var b=a[f];for(var m=0,w=o.length;m<w;m++){var v=o[m];var k=t+b[m];var x=(y-v.height)/2;if(v.isBubble)x-=2;if(v.isLabel)x+=1;if(v.icon==="▶"&&h)x=-4;v.moveTo(k,g+x)}g+=y}i=g;if(h)i+=8;this.ownWidth=r;this.ownHeight=i;this.width=r;this.height=i;this.layoutBubble(this.bubble);this.curves.forEach(function(t){return t.layoutSelf()});this.redraw()}},{key:"layoutBubble",value:function B(t){if(!t)return;var e=(this.width-t.width)/2;var r=this.height-1;t.moveTo(e,r)}},{key:"pathBlock",value:function D(t){var e=this.ownWidth;var r=this.ownHeight;var i=12;t.moveTo(0,i+.5);t.arc(i,i+.5,i,S,O,false);t.arc(e-i,i+.5,i,O,0,false);t.arc(e-i,r-i-.5,i,0,x,false);t.arc(i,r-i-.5,i,x,S,false)}},{key:"draw",value:function N(){this.canvas.width=this.ownWidth*I;this.canvas.height=this.ownHeight*I;this.canvas.style.width=this.ownWidth+"px";this.canvas.style.height=this.ownHeight+"px";this.context.scale(I,I);this.drawOn(this.context);this.bubble.el.style.visibility=this.bubbleVisible?"visible":"hidden";if(this.bubble.curve){this.bubble.curve.el.style.visibility=this.bubbleVisible?"visible":"hidden"}}},{key:"drawOn",value:function Y(t){t.fillStyle=this._color;E(t,this.pathBlock,this,false,I)}},{key:"updateSinky",value:function H(){var t=this;var e=this.outputs.filter(function(e){if(!e.parent||!t.parent)return;return!e.parent.isBlock||t.bubbleVisible&&e.parent===t}).length;this.repr.setSink(!!e)}},{key:"setDragging",value:function q(t){this.bubble.el.style.visibility=!t&&this.bubbleVisible?"visible":"hidden"}},{key:"isBlock",get:function W(){return true}},{key:"isArg",get:function U(){return true}},{key:"isDraggable",get:function J(){return true}},{key:"parent",get:function V(){return this._parent},set:function K(t){this._parent=t;if(!this.outputs)return;this.updateSinky()}},{key:"color",get:function $(){return this._color},set:function Z(t){this._color=t;this.redraw()}},{key:"bubbleVisible",get:function G(){return!this.parent.isBlock&&!(this.workspace&&this.workspace.isPalette)}},{key:"dragObject",get:function Q(){return this}}]);return e}(j);var q=function(t){p(e,t);function e(t,r){g(this,e);var i=d(this,Object.getPrototypeOf(e).call(this));i.el=k("absolute source");i.el.appendChild(i.canvas=k("canvas","absolute"));i.context=i.canvas.getContext("2d");i.node=t;i.repr=r;if(!i.repr){i.repr=P.repr(i.node);i.repr.setSink(true)}i.repr.onProgress(i.onProgress.bind(i));i.el.appendChild(i.progress=k("progress absolute"));i.result=new W(i,i.repr);i.el.appendChild(i.result.el);if(i.constructor===e){i.outputs=[];i.curves=[];i.blob=i.bubble=new rt(i);i.el.appendChild(i.blob.el)}return i}a(e,[{key:"addBubble",value:function r(t){t.curve.parent.remove(t.curve);t.parent.remove(t);this.removeOutput(t)}},{key:"onProgress",value:function i(t){this.fraction=t.loaded/t.total;if(this.fraction<1){this.progress.classList.add("progress-loading")}this.drawProgress()}},{key:"drawProgress",value:function s(){var t=this.fraction;var e=this.width-2*z.radius;this.progress.style.width=t*e+"px"}},{key:"objectFromPoint",value:function o(t,e){if(F(this.context,t*I,e*I))return this.result;var r=this.blob.objectFromPoint(t-this.blob.x,e-this.blob.y);if(r)return r;return null}},{key:"detach",value:function u(){if(this.isDoubleTap()){return this.copy()}if(this.parent.isBlock){this.parent.reset(this)}return this}},{key:"copy",value:function l(){return e.value(this.node.value)}},{key:"layoutChildren",value:function h(){this.blob.layoutChildren();this.result.layout();this.layoutSelf()}},{key:"drawChildren",value:function c(){this.blob.drawChildren();this.result.draw();this.draw()}},{key:"click",value:function f(){n(Object.getPrototypeOf(e.prototype),"click",this).call(this)}},{key:"layoutSelf",value:function v(){var t=z.paddingX;var e=z.paddingY;var r=this.result.width;var i=this.result.height;this.width=Math.max(z.minWidth,r+4);var n=0;var a=(this.width-r)/2;var s=n+e;this.result.moveTo(a,s);this.height=i+2*e+n;this.ownWidth=this.width;this.ownHeight=this.height;this.layoutBubble(this.blob);this.moved();this.redraw()}},{key:"layoutBubble",value:function y(t){var e=(this.width-t.width)/2;var r=this.height-1;t.moveTo(e,r)}},{key:"pathBubble",value:function b(t){var e=this.width;var r=this.height;var i=z.radius;var n=this.width/2;t.moveTo(1,i+1);t.arc(i+1,i+1,i,S,O,false);t.arc(e-i-1,i+1,i,O,0,false);t.arc(e-i-1,r-i-1,i,0,x,false);t.arc(i+1,r-i-1,i,x,S,false)}},{key:"draw",value:function m(){this.canvas.width=this.width*I;this.canvas.height=this.height*I;this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.context.scale(I,I);this.drawOn(this.context);this.drawProgress()}},{key:"drawOn",value:function w(t){this.pathBubble(t);t.closePath();t.fillStyle=this.invalid?"#aaa":"#fff";t.fill();t.strokeStyle="#555";t.lineWidth=I;t.stroke()}},{key:"pathShadowOn",value:function C(t){this.pathBubble(t);t.closePath()}},{key:"moveTo",value:function E(t,r){n(Object.getPrototypeOf(e.prototype),"moveTo",this).call(this,t,r);this.moved()}},{key:"moved",value:function T(){this.curves.forEach(function(t){return t.layoutSelf()})}},{key:"updateSinky",value:function _(){}},{key:"addOutput",value:function M(t){this.outputs.push(t);t.target=this;var e=new it(this,t);t.curve=e;this.curves.push(e);this.layoutBubble(t)}},{key:"removeOutput",value:function A(t){var e=this.outputs.indexOf(t);this.outputs.splice(e,1);t.parent=null}},{key:"isSource",get:function j(){return true}},{key:"isDraggable",get:function R(){return true}},{key:"isArg",get:function B(){return true}},{key:"dragObject",get:function D(){return this}}],[{key:"value",value:function L(t){return new e(P.input(t))}}]);return e}(j);var z=function(t){p(e,t);function e(t){g(this,e);var r=d(this,Object.getPrototypeOf(e).call(this,t.node,t.repr));r.el.className="absolute bubble";r.target=t;r.curve=null;if(t.workspace)t.workspace.add(r);return r}a(e,[{key:"detach",value:function r(){if(this.isDoubleTap()){return this.makeSource()}if(this.parent.isBlock){if(this.parent.bubble!==this){this.parent.reset(this)}}return this}},{key:"makeSource",value:function i(){return q.value(this.node.value)}},{key:"copy",value:function s(){var t=new e(this.target);this.target.addOutput(t);return t}},{key:"destroy",value:function o(){this.target.removeOutput(this)}},{key:"objectFromPoint",value:function u(t,e){return F(this.context,t*I,e*I)?this.result.objectFromPoint(t-this.result.x,e-this.result.y):null}},{key:"replaceWith",value:function l(t){b(this.isInside);var e=this.parent;e.replace(this,t);if(t===this.target){b(this.target.bubble.isBlob);t.addBubble(this);t.layoutChildren()}}},{key:"click",value:function h(){n(Object.getPrototypeOf(e.prototype),"click",this).call(this)}},{key:"moved",value:function c(){if(this.curve)this.curve.layoutSelf()}},{key:"layoutChildren",value:function f(){this.layoutSelf()}},{key:"drawChildren",value:function v(){this.layoutSelf()}},{key:"layoutSelf",value:function y(){var t=e.paddingX;var r=e.paddingY;var i=this.result.width;var n=this.result.height;this.width=Math.max(e.minWidth,i+4);var a=e.tipSize;var s=(this.width-i)/2;var o=a+r;this.result.moveTo(s,o-1);this.height=n+2*r+a-1;this.moved();this.redraw()}},{key:"pathBubble",value:function m(t){var r=e.tipSize;var i=this.width;var n=this.height;var a=e.radius;var s=this.width/2;t.moveTo(1,r+a);t.arc(a+1,r+a,a,S,O,false);t.lineTo(s-r,r);t.lineTo(s,1);t.lineTo(s+r,r);t.arc(i-a-1,r+a,a,O,0,false);t.arc(i-a-1,n-a-1,a,0,x,false);t.arc(a+1,n-a-1,a,x,S,false)}},{key:"isSource",get:function w(){return false}},{key:"isBubble",get:function k(){return true}},{key:"isDraggable",get:function C(){return true}},{key:"parent",get:function E(){return this._parent},set:function T(t){this._parent=t;if(this.target)this.target.updateSinky()}},{key:"isInside",get:function _(){return this.parent.isBlock&&this.parent.bubble!==this}}]);return e}(q);z.measure=A("result-label");z.tipSize=7;z.radius=6;z.paddingX=4;z.paddingY=2;z.minWidth=32;var W=function(t){p(e,t);function e(t,r){g(this,e);var i=d(this,Object.getPrototypeOf(e).call(this));i.parent=t;i.el.className+=" result";i.elContents.className+=" result-contents";b(r instanceof P);i.repr=r;i.view=null;i.display();setTimeout(function(){return i.display(i.repr.value)});i.repr.onEmit(i.onEmit.bind(i));return i}a(e,[{key:"objectFromPoint",value:function r(t,e){var r=this.view.objectFromPoint(t-this.view.x,e-this.view.y);return r?r:this}},{key:"detach",value:function i(){return this.parent.detach()}},{key:"cloneify",value:function n(t){var e=this.result.parent;if(t){if(e.isInside){return e.copy()}else{return e.detach()}}else{return e.makeSource()}}},{key:"fixZoom",value:function s(t){return Math.max(1,t)}},{key:"click",value:function o(){this.parent.click()}},{key:"display",value:function u(t){this.elContents.innerHTML="";this.view=U.fromJSON(t);this.view.layoutChildren();this.view.drawChildren();this.view.parent=this;this.elContents.appendChild(this.view.el);this.layout()}},{key:"onEmit",value:function l(t){var e=this;if(t===null){this.elContents.classList.add("result-invalid");return}this.elContents.classList.remove("result-invalid");this.display(t);if(this.fraction===0)this.fraction=1;this.parent.drawProgress();setTimeout(function(){e.parent.progress.classList.remove("progress-loading")})}},{key:"layout",value:function h(){if(!this.parent)return;this.layoutSelf();this.parent.layout()}},{key:"layoutSelf",value:function c(){var t=this.view.marginX;var r,i;if(this.view.isBlock){r=i=this.view.marginY}else{r=1;i=-1}var n=this.view.width+2*t;var a=Math.max(12,this.view.height+r+i);this.view.moveTo(t,r);this.contentsRight=n;this.contentsBottom=a;this.width=Math.min(e.maxWidth,n);this.height=Math.min(e.maxHeight,a);this.makeBounds();this.draw()}},{key:"draw",value:function f(){this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"}},{key:"moveTo",value:function v(t,e){this.x=t|0;this.y=e|0;this.el.style.transform="translate("+this.x+"px, "+this.y+"px)"}},{key:"isDraggable",get:function y(){return true}},{key:"dragObject",get:function m(){return this.parent}},{key:"isZoomable",get:function w(){return true}},{key:"isScrollable",get:function k(){return this.contentsRight>e.maxWidth||this.contentsBottom>e.maxHeight||this.view instanceof Z}},{key:"result",get:function x(){return this}}]);return e}(R);W.maxWidth=512;W.maxHeight=512;var U=function(t){p(e,t);function e(t,r){g(this,e);var i=d(this,Object.getPrototypeOf(e).call(this));i.width=t;i.height=r;i.widthMode=i.width==="auto"?"auto":"natural";i.heightMode=i.height==="auto"?"auto":"natural";return i}a(e,[{key:"setHover",value:function r(t){if(this.parent.setHover){this.parent.setHover(t)}}},{key:"detach",value:function i(){if(this.isDoubleTap()){return this.cloneify()}return this.result.detach()}},{key:"cloneify",value:function n(t){return this.parent.cloneify(t)}},{key:"setWidth",value:function s(t){this.width=t;this.layoutSelf()}},{key:"setHeight",value:function o(t){this.height=t;this.layoutSelf()}},{key:"layoutView",value:function u(t,e){this.naturalWidth=t;this.naturalHeight=e;var r=this.widthMode;var i=this.heightMode;this.width=r==="natural"?t:r==="auto"?null:this.width;this.height=i==="natural"?e:i==="auto"?null:this.height}},{key:"layoutSelf",value:function l(){this.layoutView(this.width,this.height);this.redraw()}},{key:"objectFromPoint",value:function h(t,e){return C(this,t,e)?this:null}},{key:"draw",value:function c(){}},{key:"result",get:function f(){return this.parent.result}},{key:"isDraggable",get:function v(){return true}},{key:"dragObject",get:function y(){return this}},{key:"marginX",get:function b(){return 4}},{key:"marginY",get:function m(){return 2}}],[{key:"fromJSON",value:function w(t){if(!t)return new V("null","");t=t.slice();var r=t.shift();var i=e.classes[r];return i.fromArgs.apply(i,t)}},{key:"fromArgs",value:function k(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++){e[r]=arguments[r]}return new(Function.prototype.bind.apply(this,[null].concat(e)))}}]);return e}(j);var J=function(t){p(e,t);function e(t,r,i,n){g(this,e);var a=d(this,Object.getPrototypeOf(e).call(this,r,i));a.el=k("div","rect "+(n||""));a.fill=t;return a}a(e,[{key:"draw",value:function r(){this.el.style.width=this.width+"px";this.el.style.height=this.height+"px";this.el.style.background=this.fill}},{key:"isBlock",get:function i(){return true}},{key:"fill",get:function n(){return this._fill},set:function s(t){this._fill=t;this.redraw()}}]);return e}(U);var V=function(t){p(e,t);function e(t,r,i,n){g(this,e);var a=d(this,Object.getPrototypeOf(e).call(this,i,n));a.cls=t||"";a.el=k("absolute text "+t);a.text=r;return a}a(e,[{key:"draw",value:function r(){this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"}},{key:"isInline",get:function i(){return true}},{key:"text",get:function n(){return this._text},set:function s(t){this._text=t=""+t;this.el.textContent=t;if(!e.measure[this.cls]){e.measure[this.cls]=A("text "+this.cls)}var r=e.measure[this.cls](t);this.layoutView(r.width,r.height|0);this.layout()}}]);return e}(U);V.measure={};var K=function(t){p(e,t);function e(t,r,i){g(this,e);var n=d(this,Object.getPrototypeOf(e).call(this,r,i));n.el=k("absolute view-inline");n.children=t;t.forEach(function(t){t.parent=n;n.el.appendChild(t.el)});return n}a(e,[{key:"layoutChildren",value:function r(){this.children.forEach(function(t){return t.layoutChildren()});if(this.dirty){this.dirty=false;this.layoutSelf()}}},{key:"drawChildren",value:function i(){this.children.forEach(function(t){return t.drawChildren()});if(this.graphicsDirty){this.graphicsDirty=false;this.draw()}}},{key:"layoutSelf",value:function n(){var t=this.children;var e=t.length;var r=0;var i=0;var n=[];for(var a=0;a<e;a++){var s=t[a];n.push(r);r+=s.width;i=Math.max(i,s.height)}this.width=r;this.height=i;for(var a=0;a<e;a++){var s=t[a];s.moveTo(n[a],(i-s.height)/2|0)}}},{key:"objectFromPoint",value:function s(t,e){if(C(this,t,e)){var r=this.children;for(var i=r.length;i--;){var n=r[i];var a=n.objectFromPoint(t-n.x,e-n.y);if(a)return a}return this}return null}},{key:"isInline",get:function o(){return true}}],[{key:"fromArgs",value:function u(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++){r[i-1]=arguments[i]}return new(Function.prototype.bind.apply(this,[null].concat([t.map(U.fromJSON)],r)))}}]);return e}(U);var $=function(t){p(e,t);function e(t,r,i){g(this,e);var n=d(this,Object.getPrototypeOf(e).call(this,t,r,i));n.el.className="absolute view-block";return n}a(e,[{key:"layoutSelf",value:function r(){var t=this.children;var e=t.length;var r=0;var i=0;var n=[];var a=0;for(var s=0;s<e;s++){var o=t[s];if(s>0)r+=Math.max(o.marginY,a);a=o.marginY;n.push(r);r+=o.height;if(o.width!==null){i=Math.max(i,o.width)}}this.width=i;this.height=r;this._marginY=o?Math.max(o.marginY,t[0].marginY):4;for(var s=0;s<e;s++){var o=t[s];if(o.width===null){o.width=i}var u=o.isInline?(i-o.width)/2:0;var r=n[s];o.moveTo(u,r)}}},{key:"isInline",get:function i(){return false}},{key:"isBlock",get:function n(){return true}},{key:"marginY",get:function s(){return this._marginY}}]);return e}(K);var Z=function(t){p(e,t);function e(t,r,i){g(this,e);var n=d(this,Object.getPrototypeOf(e).call(this,r,i));n.el=t.cloneNode();n.el.className="absolute view-image";return n}a(e,[{key:"layoutSelf",value:function r(){var t=this.el.naturalWidth;var e=this.el.naturalHeight;var r=256;var i=256;var n=Math.min(1,r/t,i/e);this.width=t*n|0;this.height=e*n|0;this.redraw()}},{key:"draw",value:function i(){this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"}},{key:"isBlock",get:function n(){return true}},{key:"marginX",get:function s(){return 6}},{key:"marginY",get:function o(){return 6}}]);return e}(U);var G=function(t){p(e,t);function e(){g(this,e);return d(this,Object.getPrototypeOf(e).apply(this,arguments))}a(e,[{key:"isBlock",get:function r(){return true}}]);return e}(U);var Q=function(t){p(e,t);function e(t,r,i){g(this,e);var n=d(this,Object.getPrototypeOf(e).call(this));n.el=k("absolute cell "+t+"-cell");n.child=r;r.parent=n;n.el.appendChild(r.el);n.isRecord=t==="record"||t==="header";n.paddingX=n.isRecord?6:2;n.paddingY=0;n.key=i;return n}a(e,[{key:"objectFromPoint",value:function r(t,e){if(C(this,t,e)){var r=this.child.objectFromPoint(t-this.child.x,e-this.child.y);if(r)return r;return this}return null}},{key:"cloneify",value:function i(t){var r=this.key;switch(this.parent.cls){case"list":var i=ut["item %n of %l"].copy();break;case"header":case"record":var i=ut["%q of %o"].copy();break;case"field":var i=ut["%q of %o"].copy();r=this.parent.key;break;default:return n(Object.getPrototypeOf(e.prototype),"cloneify",this).call(this,t)}i.inputs[0].value=r;i.replace(i.inputs[1],this.parent.cloneify(true));return i}},{key:"layoutChildren",value:function s(){this.child.layoutChildren();this.layoutSelf()}},{key:"drawChildren",value:function o(){this.child.drawChildren();if(this.graphicsDirty){this.graphicsDirty=false;this.draw()}}},{key:"setWidth",value:function u(t){this.child.setWidth(t-2*this.paddingX);this.layoutSelf()}},{key:"setHeight",value:function l(t){this.child.setHeight(t-2*this.paddingY);this.layoutSelf()}},{key:"layoutSelf",value:function h(){this.width=this.child.width+2*this.paddingX;this.height=this.child.height+2*this.paddingY;this.child.moveTo(this.paddingX,this.paddingY);this.redraw()}},{key:"draw",value:function c(){this.el.style.width=this.width+"px";this.el.style.height=this.height+"px";this.el.style.padding=this.paddingY+"px "+this.paddingX+"px"}},{key:"setHover",value:function f(t){this.el.style.background=t?"#dfe5ff":""}},{key:"marginX",get:function v(){return this.isRecord?0:this.paddingX}}],[{key:"fromArgs",value:function y(t,e){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++){i[n-2]=arguments[n]}return new(Function.prototype.bind.apply(this,[null].concat([t,U.fromJSON(e)],i)))}}]);return e}(U);var tt=function(t){p(e,t);function e(t,r,i){g(this,e);if(t==="header"||t==="row"){i=[new V("table-index",r===null?"":r+1)].concat(i)}else if(t!=="field"){i=[new V("item-index",r+1)].concat(i)}var n=d(this,Object.getPrototypeOf(e).call(this,i));n.cls=t;n.el.className+=" absolute row-"+t;n.key=t==="field"?i[0].text:r+1;return n}a(e,[{key:"cloneify",value:function r(t){var r=this.key;switch(this.cls){case"header":return n(Object.getPrototypeOf(e.prototype),"cloneify",this).call(this,true);case"record":case"item":case"list":var i=ut["item %n of %l"].copy();break;default:return n(Object.getPrototypeOf(e.prototype),"cloneify",this).call(this,t)}i.inputs[0].value=r;i.replace(i.inputs[1],this.parent.cloneify(true));return i}},{key:"layoutSelf",value:function i(){var t=this.children;var e=t.length;var r=0;var i=0;var n=[];var a;for(var s=0;s<e;s++){var o=t[s];r+=o.marginX;n.push(r);r+=o.width;r+=o.marginX;i=Math.max(i,o.height)}this.width=r;this.height=i}},{key:"layoutRow",value:function s(t){var e=this.children;var r=e.length;var i=0;for(var n=0;n<r;n++){var a=e[n];var s=a.marginX;var o=t[n]||a.width+2*s;a.setWidth(o-2*s);a.moveTo(i+s,0);i+=o}this.width=i}},{key:"draw",value:function o(){this.el.style.width=this.width+"px";this.el.style.height=this.height+"px"}},{key:"isInline",get:function u(){return false}},{key:"isBlock",get:function l(){return true}},{key:"marginY",get:function h(){return this.cls==="record"||this.cls==="header"?0:4}}],[{key:"fromArgs",value:function c(t,e,r){for(var i=arguments.length,n=Array(i>3?i-3:0),a=3;a<i;a++){n[a-3]=arguments[a]}return new(Function.prototype.bind.apply(this,[null].concat([t,e,r.map(U.fromJSON)],n)))}}]);return e}(K);var et=function(t){p(e,t);function e(){g(this,e);return d(this,Object.getPrototypeOf(e).apply(this,arguments))}a(e,[{key:"layoutSelf",value:function r(){var t=this.children;var e=t.length;var r=0;var i=[];var n=[];var a=0;var s;var o;var u=0;for(var l=0;l<e;l++){var h=t[l];if(l>0)r+=Math.max(h.marginY,s);s=h.marginY;i.push(r);r+=h.height;b(h instanceof tt);if(!o){o=h.cls==="header"?"record":h.cls}else if(h.cls!==o){u=Math.max(u,h.width);h.layoutRow([]);continue}var c=h.children;a=Math.max(a,c.length);for(var f=0;f<a;f++){var v=c[f];var d=v?v.width+2*v.marginX:0;n[f]=Math.max(n[f]||0,d)}}var p=2;var g=0;for(var l=0;l<a;l++){g+=n[l]}this.width=Math.max(u,g+2*p);this.height=r;this._marginY=h?Math.max(h.marginY,t[0].marginY):2;for(var l=0;l<e;l++){var h=t[l];h.layoutRow(n);h.moveTo(p,i[l])}}},{key:"marginY",get:function i(){if(this.children.length){var t=this.children[0];if(t instanceof tt&&t.cls==="header"){return 4}return 4}return 0}}]);return e}($);U.classes={rect:J,text:V,image:Z,inline:K,block:$,table:et,row:tt,cell:Q};var rt=function(t){p(e,t);function e(t){g(this,e);var r=d(this,Object.getPrototypeOf(e).call(this));r.el=k("absolute");r.el.appendChild(r.canvas=k("canvas","absolute"));r.context=r.canvas.getContext("2d");r.parent=t;r.target=t;r.setHover(false);return r}a(e,[{key:"objectFromPoint",value:function r(t,e){var r=8;var i=8;var n={width:this.width+r*2,height:this.height+i};if(C(n,t+r,e)){return this}}},{key:"setHover",value:function i(t){this.color=t?"#5B57C5":"#636284"}},{key:"detach",value:function n(){var t=this.target;var e=new z(t);t.addOutput(e);return e}},{key:"dragOffset",value:function s(t){return{x:-t.width/2+this.width/2,y:-1}}},{key:"replaceWith",value:function o(t){b(t.isBubble&&t.target===this.target&&this.target.bubble===this);

this.target.addBubble(t)}},{key:"layoutSelf",value:function u(){this.width=e.radius*2;this.height=e.radius*2;this.redraw()}},{key:"pathBlob",value:function l(t){var r=e.radius;var i=r*2;t.moveTo(r,0);t.arc(r,r,r,0,2*Math.PI)}},{key:"draw",value:function h(){this.canvas.width=this.width*I;this.canvas.height=this.height*I;this.canvas.style.width=this.width+"px";this.canvas.style.height=this.height+"px";this.canvas.style.left=(this.width-this.canvasWidth)/2+"px";this.canvas.style.top="0px";this.context.scale(I,I);this.drawOn(this.context)}},{key:"drawOn",value:function c(t){this.pathBlob(t);t.closePath();t.fillStyle=this.color;t.fill()}},{key:"pathShadowOn",value:function f(t){this.pathBlob(t);t.closePath()}},{key:"isBlob",get:function v(){return true}},{key:"isDraggable",get:function y(){return true}},{key:"color",get:function m(){return this._color},set:function w(t){this._color=t;this.redraw()}},{key:"dragObject",get:function x(){return this}}]);return e}(j);rt.radius=6;var it=function(t){p(e,t);function e(t,r){g(this,e);b(t);b(r);var i=d(this,Object.getPrototypeOf(e).call(this));i.el=k("absolute curve");i.el.appendChild(i.canvas=k("canvas","absolute"));i.context=i.canvas.getContext("2d");i.target=t;i.result=r;if(t.workspace)t.workspace.add(i);return i}a(e,[{key:"objectFromPoint",value:function r(){}},{key:"destroy",value:function i(){if(this.workspace)this.workspace.remove(this)}},{key:"layoutSelf",value:function n(){if(!this.workspace)return;var t=this.target;var e=this.workspace.positionOf(t);e.x+=t.width/2-1;e.y+=t.ownHeight-2;var r=this.result;var i=this.workspace.positionOf(r);i.x+=r.width/2-1;var n=i.x-e.x+.5|0;var a=i.y-e.y+.5|0;if(n<0)e.x+=n;if(a<0)e.y+=a;this.moveTo(e.x|0,e.y|0);this.width=Math.abs(n)+2;this.height=Math.abs(a)+2;this.dx=n;this.dy=a;this.draw()}},{key:"draw",value:function s(){var t=Math.abs(this.width);var e=Math.abs(this.height);this.canvas.width=t*I;this.canvas.height=e*I;this.canvas.style.width=t+"px";this.canvas.style.height=e+"px";this.context.scale(I,I);this.drawOn(this.context)}},{key:"drawOn",value:function o(t){var e=this.width;var r=this.height;t.save();t.translate(this.dx<0?e:0,this.dy<0?r:0);t.scale(this.dx<0?-1:+1,this.dy<0?-1:+1);t.beginPath();t.moveTo(1,1);t.bezierCurveTo(1,r/2,e-1,r/2,e-1,r-1);t.lineWidth=I;t.strokeStyle="#555";t.stroke();t.restore()}},{key:"isCurve",get:function u(){return true}}]);return e}(j);var nt=function(t){p(e,t);function e(){g(this,e);var t=d(this,Object.getPrototypeOf(e).call(this));t.el.className+=" workspace no-select";t.scripts=[];return t}a(e,[{key:"layout",value:function r(){}},{key:"objectFromPoint",value:function i(t,e){var r=this.fromScreen(t,e);var i=this.scripts;for(var n=i.length;n--;){var a=i[n];var s=a.objectFromPoint(r.x-a.x,r.y-a.y);if(s)return s}return this}},{key:"resize",value:function s(){n(Object.getPrototypeOf(e.prototype),"resize",this).call(this);var t=this.el.getBoundingClientRect();this.screenX=Math.round(t.left);this.screenY=Math.round(t.top);this.screenPosition={x:this.screenX,y:this.screenY}}},{key:"scrollBy",value:function o(t,r){n(Object.getPrototypeOf(e.prototype),"scrollBy",this).call(this,t,r);if(this.app)this.app.workspaceScrolled()}},{key:"positionOf",value:function u(t){if(t.workspace===this){return t.workspacePosition}var e=t.screenPosition;return this.worldPositionOf(e.x,e.y)}},{key:"worldPositionOf",value:function l(t,e){return this.fromScreen(t-this.screenX,e-this.screenY)}},{key:"screenPositionOf",value:function h(t,e){return this.toScreen(t+this.screenX,e+this.screenY)}},{key:"add",value:function c(t){if(t.parent)t.parent.remove(t);t.parent=this;t.zoom=1;this.scripts.push(t);t.layoutChildren();t.drawChildren();if(t.isCurve){this.elContents.insertBefore(t.el,this.elContents.children[0])}else{this.elContents.appendChild(t.el)}if(t.isBlock&&t.bubble&&t.bubble.isBubble){this.add(t.bubble.curve)}}},{key:"remove",value:function f(t){b(t.parent===this);t.parent=null;var e=this.scripts.indexOf(t);this.scripts.splice(e,1);this.elContents.removeChild(t.el)}},{key:"isWorkspace",get:function v(){return true}}]);return e}(R);var at={ring:"#969696",math:"#5cb712",text:"#0e9a6c",bool:"#e1a91a",list:"#cc5b22",color:"#8a55d7",record:"#c88330",sensing:"#2ca5e2",variable:"#ee7d16",custom:"#632d99",arg:"#5947b1"};var st;var ot=[];var ut={};f.specs.forEach(function(t){var e=i(t,3);var r=e[0];var n=e[1];var a=e[2];var s=(a||[]).slice();var o=at[r]||"#555";var u=n.split(/ /g);var l=0;var h;var c;var f=[];u.forEach(function(t,e){if(t==="%r"){f.push(st.copy())}else if(t==="%b"){var r=s.length?s.shift():!!(l++%2);f.push(new N(r))}else if(t==="%fields"){h=function i(){return[new L,new D("name","Symbol"),new D("","Text")]};c=3}else if(t==="%exp"){h=function n(){return[new L,new D(s[this.parts.length-e-3]||"","Text")]};c=2;f.push(new L);f.push(new D(s.length?s.shift():"","Text"))}else if(t==="%%"){f.push(new B("%"))}else if(t==="%br"){f.push(new L)}else if(/^%/.test(t)){var r=s.length?s.shift():t==="%c"?"#007de0":"";f.push(new D(r,{"%n":"Num","%o":"Record","%l":"List","%c":"Color","%m":"Menu","%q":"Symbol"}[t]))}else{f.push(new B(t))}});var v=r==="ring";var d=new H({spec:n,category:r,color:o,isRing:v},f);ut[n]=d;if(h){d.count=1+s.length;s.forEach(function(t){var e=new D(t,"Text");d.add(new L);d.add(e);d.inputs.push(e)});var p=new X("◀",function(){if(this===d)return;for(var t=0;t<c;t++){var e=this.parts[this.parts.length-3-t];if(!(e.isInput||e.isBreak))return}this.count--;this.wrap=false;for(var t=0;t<c;t++){this.remove(this.parts[this.parts.length-3]);this.inputs.pop()}if(this.count===1){this.remove(this.parts[this.parts.length-2])}});if(s.length)d.add(p);d.add(new X("▶",function(){var t=this;if(this===d)return;this.count++;if(this.count===2){this.insert(p.copy(),this.parts.length-1)}h.call(this).forEach(function(e,r){t.insert(e,t.parts.length-2);t.inputs.push(e);if(r===1)e.click()})}))}if(v){st=d;return}if(r==="hidden"){return}ot.push(d)});var lt=function(t){p(e,t);function e(t){g(this,e);var r=d(this,Object.getPrototypeOf(e).call(this));r.parent=t;r.el=k("input","absolute search");r.el.setAttribute("type","search");r.el.setAttribute("placeholder","search");r.el.style.left="8px";r.el.style.top="8px";r.el.style.width="240px";r.el.addEventListener("input",r.change.bind(r));r.el.addEventListener("keydown",r.keyDown.bind(r));r.layout();return r}a(e,[{key:"click",value:function r(){this.el.focus()}},{key:"layout",value:function i(){this.width=242;this.height=28}},{key:"change",value:function n(t){this.parent.filter(this.el.value)}},{key:"keyDown",value:function s(t){if(t.keyCode===13){}}}]);return e}(j);var ht=function(t){p(e,t);function e(){g(this,e);var t=d(this,Object.getPrototypeOf(e).call(this));t.el.className+=" palette";t.search=new lt(t);t.elContents.appendChild(t.search.el);t.blocks=ot;t.blocks.forEach(function(e){t.add(e)});return t}a(e,[{key:"layout",value:function r(){}},{key:"filter",value:function i(t){var e=t.split(/ /g).map(function(t){return new RegExp(RegExp.escape(t),"i")});function r(r){if(!t)return true;for(var i=0;i<e.length;i++){var n=e[i];if(n.test(r.info.spec)||n.test(r.info.category)){continue}return false}return true}var i=0;var n=48;this.blocks.forEach(function(t){if(r(t)){t.moveTo(8,n);i=Math.max(i,t.width);t.el.style.visibility="visible";t.hidden=false;n+=t.height+8}else{t.el.style.visibility="hidden";t.hidden=true}});this.contentsBottom=n;this.contentsRight=i+16;this.scrollY=0;this.makeBounds();this.transform()}},{key:"objectFromPoint",value:function n(t,e){var r=this.fromScreen(t,e);if(C(this.search,r.x-this.search.x,r.y-this.search.y)){return this.search}var i=this.scripts;for(var n=i.length;n--;){var a=i[n];if(a.hidden)continue;var s=a.objectFromPoint(r.x-a.x,r.y-a.y);if(s)return s}return this}},{key:"isPalette",get:function s(){return true}}]);return e}(nt);var ct=function(t){p(e,t);function e(){g(this,e);var t=d(this,Object.getPrototypeOf(e).call(this));t.el.className+=" world";t.elContents.className+=" world-contents";return t}a(e,[{key:"fixZoom",value:function r(t){return Math.min(4,this.zoom)}},{key:"isWorld",get:function i(){return true}},{key:"isInfinite",get:function n(){return true}},{key:"isZoomable",get:function s(){return true}}]);return e}(nt);var ft=function(){function t(){g(this,t);this.el=k("app");this.workspaces=[];document.body.appendChild(this.el);document.body.appendChild(this.elScripts=k("absolute dragging"));this.world=new ct(this.elWorld=k(""));this.palette=new ht(this.elPalette=k(""));this.workspaces=[this.world,this.palette];this.el.appendChild(this.world.el);this.el.appendChild(this.palette.el);this.world.app=this;this.resize();this.palette.filter("");this.palette.search.el.focus();this.fingers=[];this.feedbackPool=[];this.feedback=this.createFeedback();document.addEventListener("touchstart",this.touchStart.bind(this));document.addEventListener("touchmove",this.touchMove.bind(this));document.addEventListener("touchend",this.touchEnd.bind(this));document.addEventListener("touchcancel",this.touchEnd.bind(this));document.addEventListener("mousedown",this.mouseDown.bind(this));document.addEventListener("mousemove",this.mouseMove.bind(this));document.addEventListener("mouseup",this.mouseUp.bind(this));this.scroll=null;window.addEventListener("resize",this.resize.bind(this));document.addEventListener("wheel",this.wheel.bind(this));document.addEventListener("mousewheel",this.wheel.bind(this));document.addEventListener("gesturestart",this.gestureStart.bind(this));document.addEventListener("gesturechange",this.gestureChange.bind(this));document.addEventListener("gestureend",this.gestureEnd.bind(this));document.addEventListener("keydown",this.keyDown.bind(this))}a(t,[{key:"layout",value:function e(){}},{key:"resize",value:function r(t){this.workspaces.forEach(function(t){return t.resize()})}},{key:"keyDown",value:function i(t){if(t.altKey)return;if(y&&t.ctrlKey)return;if(y?t.metaKey:t.ctrlKey){if(t.keyCode===70){this.palette.search.el.focus();t.preventDefault()}}if(t.target===document.body){if(t.keyCode===8){t.preventDefault()}}}},{key:"wheel",value:function n(t){if(!this.scroll){var e=this.frameFromPoint(t.clientX,t.clientY);if(!t.ctrlKey){var r=e;while(r&&!r.canScroll(t.deltaX,t.deltaY)){do{r=r.parent}while(r&&!r.isScrollable)}if(r)e=r}this.scroll={frame:e}}if(this.scroll.timeout)clearTimeout(this.scroll.timeout);this.scroll.timeout=setTimeout(this.endScroll.bind(this),200);var e=this.scroll.frame;if(t.ctrlKey){if(e.isScrollable){t.preventDefault();var i=Math.pow(1.01,-t.deltaY);e.zoomBy(i,t.clientX,t.clientY)}}else if(e.isScrollable){t.preventDefault();e.scrollBy(t.deltaX,t.deltaY)}}},{key:"endScroll",value:function s(){this.scroll=null}},{key:"workspaceScrolled",value:function o(){if(this.dragging){this.dragScript.moved()}this.fingers.forEach(function(t){if(t.dragging){t.dragScript.moved()}})}},{key:"gestureStart",value:function u(t){t.preventDefault();if(isNaN(t.scale))return;var e=this.frameFromPoint(t.clientX,t.clientY);if(e){if(e.isScrollable){this.gesture={frame:e,lastScale:1}}}}},{key:"gestureChange",value:function l(t){t.preventDefault();if(!this.gesture)return;if(isNaN(t.scale)||!isFinite(t.scale)){return}var e=this.gesture;e.frame.zoomBy(t.scale/e.lastScale,t.clientX,t.clientY);e.lastScale=t.scale}},{key:"gestureEnd",value:function h(t){this.gesture=null}},{key:"mouseDown",value:function c(t){var e={clientX:t.clientX,clientY:t.clientY,identifier:this};if(!this.startFinger(e,t))return;this.fingerDown(e,t)}},{key:"mouseMove",value:function f(t){var e={clientX:t.clientX,clientY:t.clientY,identifier:this};this.fingerMove(e,t)}},{key:"mouseUp",value:function v(t){var e={clientX:t.clientX,clientY:t.clientY,identifier:this};this.fingerUp(e,t)}},{key:"touchStart",value:function d(t){var e=t.changedTouches[0];var r={clientX:e.clientX,clientY:e.clientY,identifier:e.identifier};if(!this.startFinger(r,t))return;this.fingerDown(r,t);for(var i=t.changedTouches.length;i-->1;){e=t.changedTouches[i];this.fingerDown({clientX:e.clientX,clientY:e.clientY,identifier:e.identifier},t)}}},{key:"touchMove",value:function p(t){var e=t.changedTouches[0];var r={clientX:e.clientX,clientY:e.clientY,identifier:e.identifier};this.fingerMove(r,t);for(var i=t.changedTouches.length;i-->1;){var e=t.changedTouches[i];this.fingerMove({clientX:e.clientX,clientY:e.clientY,identifier:e.identifier},t)}}},{key:"touchEnd",value:function m(t){var e=t.changedTouches[0];var r={clientX:e.clientX,clientY:e.clientY,identifier:e.identifier};this.fingerUp(r,t);for(var i=t.changedTouches.length;i-->1;){var e=t.changedTouches[i];this.fingerUp({clientX:e.clientX,clientY:e.clientY,identifier:e.identifier},t)}}},{key:"createFinger",value:function w(t){if(t===this){var e=this}else{this.destroyFinger(t);e=this.getFinger(t)}return e}},{key:"getFinger",value:function x(t){if(t===this)return this;var e=this.fingers[t];if(e)return e;return this.fingers[t]={feedback:this.createFeedback()}}},{key:"destroyFinger",value:function S(t){var e=t===this?this:this.fingers[t];if(e){if(e.dragging)this.drop(e);this.destroyFeedback(e.feedback);e.pressed=false;e.pressObject=null;e.dragging=false;e.scrolling=false;e.resizing=false;e.shouldDrag=false;e.dragScript=null;if(e.hoverScript)e.hoverScript.setHover(false);e.hoverScript=null;delete this.fingers[t]}}},{key:"startFinger",value:function O(t,e){return true}},{key:"objectFromPoint",value:function F(t,e){var r=this.workspaceFromPoint(t,e);if(!r)return null;var i=r.screenPosition;return r.objectFromPoint(t-i.x,e-i.y)}},{key:"frameFromPoint",value:function E(t,e){return this.frameFromObject(this.objectFromPoint(t,e))}},{key:"frameFromObject",value:function T(t){while(!t.isScrollable){t=t.parent}return t}},{key:"workspaceFromPoint",value:function _(t,e){var r=this.workspaces;for(var i=r.length;i--;){var n=r[i];var a=n.screenPosition;if(C(n,t-a.x,e-a.y))return n}return null}},{key:"fingerDown",value:function P(t,e){var r=this.createFinger(t.identifier);r.pressX=r.mouseX=t.clientX;r.pressY=r.mouseY=t.clientY;r.pressObject=this.objectFromPoint(r.pressX,r.pressY);r.shouldDrag=false;r.shouldScroll=false;if(r.pressObject){var i=e.button===0||e.button===undefined;if(e.button===2||i&&e.ctrlKey){}else if(i){r.canFingerScroll=e.button===undefined;r.shouldDrag=r.pressObject.isDraggable;r.shouldScroll=r.pressObject.isScrollable&&r.canFingerScroll}}if(r.shouldDrag||r.shouldScroll){document.activeElement.blur();e.preventDefault()}if(r.shouldScroll){r.pressObject.fingerScroll(0,0)}r.pressed=true;r.dragging=false;r.scrolling=false}},{key:"fingerMove",value:function I(t,e){var r=this.getFinger(t.identifier);r.mouseX=t.clientX;r.mouseY=t.clientY;if(r.pressed&&r.shouldDrag&&!r.dragging&&r.canFingerScroll){var i=r.pressObject.dragObject;var n=this.frameFromObject(r.pressObject);var a=r.mouseX-r.pressX;var s=r.mouseY-r.pressY;var o=n.isPalette&&Math.abs(a)<Math.abs(s)||!n.isWorkspace&&n.canScroll(-a,-s);if(o){r.shouldDrag=false;r.shouldScroll=true;r.pressObject=n}}if(r.pressed&&r.shouldDrag&&!r.dragging){this.drop(r);r.shouldScroll=false;var i=r.pressObject.dragObject;var u=i.screenPosition;r.dragging=true;r.dragWorkspace=i.workspace;r.dragX=u.x-r.pressX;r.dragY=u.y-r.pressY;b(""+r.dragX!=="NaN");r.dragScript=i.detach();if(i.dragOffset){var l=i.dragOffset(r.dragScript);r.dragX+=l.x*this.world.zoom;r.dragY+=l.y*this.world.zoom}if(r.dragScript.parent){r.dragScript.parent.remove(r.dragScript)}r.dragScript.parent=this;r.dragScript.zoom=this.world.zoom;this.elScripts.appendChild(r.dragScript.el);r.dragScript.layoutChildren();r.dragScript.drawChildren();r.dragScript.setDragging(true)}else if(r.pressed&&r.shouldScroll&&!r.scrolling){r.scrolling=true;r.shouldScroll=false;r.scrollX=r.pressX;r.scrollY=r.pressY}if(r.scrolling||r.dragging){if(r.hoverScript)r.hoverScript.setHover(false);r.hoverScript=null}if(r.scrolling){r.pressObject.fingerScroll(r.mouseX-r.scrollX,r.mouseY-r.scrollY);r.scrollX=r.mouseX;r.scrollY=r.mouseY;e.preventDefault()}else if(r.dragging){r.dragScript.moveTo(r.dragX+r.mouseX,r.dragY+r.mouseY);this.showFeedback(r);e.preventDefault()}var i=this.objectFromPoint(r.mouseX,r.mouseY);if(!i||!i.setHover)i=null;if(i!==r.hoverScript){if(r.hoverScript)r.hoverScript.setHover(false);r.hoverScript=i;if(r.hoverScript)r.hoverScript.setHover(true)}}},{key:"fingerUp",value:function M(t,e){var r=this.getFinger(t.identifier);if(r.scrolling){r.pressObject.fingerScrollEnd()}else if(r.dragging){this.drop(r)}else if(r.shouldDrag||r.shouldResize){r.pressObject.click(r.pressX,r.pressY)}this.destroyFinger(t.identifier)}},{key:"drop",value:function A(t){var e=this;if(!t)t=this.getGesture(this);if(!t.dragging)return;t.feedback.canvas.style.display="none";t.dragScript.setDragging(false);if(t.feedbackInfo){var r=t.feedbackInfo;r.obj.replaceWith(t.dragScript)}else{t.dropWorkspace=this.workspaceFromPoint(t.dragX+t.mouseX,t.dragY+t.mouseY)||this.world;var i=t.dragScript;var n=false;if(i.isBlock||i.isSource){n=i.outputs.filter(function(t){return t.parent!==i&&t.parent.isBlock}).length===0}if(t.dropWorkspace.isPalette&&n){this.remove(i);i.outputs.forEach(function(t){if(t.parent===e.world)e.world.remove(t);if(t.curve.parent===e.world)e.world.remove(t.curve)});i.destroy()}else{t.dropWorkspace=this.world;var a=t.dropWorkspace.worldPositionOf(t.dragX+t.mouseX,t.dragY+t.mouseY);t.dropWorkspace.add(i);i.moveTo(a.x,a.y)}}t.dragging=false;t.dragPos=null;t.dragState=null;t.dragWorkspace=null;t.dragScript=null;t.dropWorkspace=null;t.feedbackInfo=null;t.commandScript=null}},{key:"remove",value:function j(t){this.elScripts.removeChild(t.el)}},{key:"createFeedback",value:function R(){if(this.feedbackPool.length){return this.feedbackPool.pop()}var t=k("canvas","absolute feedback");var e=t.getContext("2d");t.style.display="none";document.body.appendChild(t);return e}},{key:"destroyFeedback",value:function B(t){if(t){this.feedbackPool.push(t)}}},{key:"showFeedback",value:function D(t){var e=this;t.feedbackDistance=Infinity;t.feedbackInfo=null;var r=this.workspaceFromPoint(t.mouseX,t.mouseY);if(r===this.world){var i=r.screenPositionOf(0,0);r.scripts.forEach(function(r){return e.addFeedback(t,i.x,i.y,r)})}if(t.feedbackInfo){this.renderFeedback(t);t.feedback.canvas.style.display="block"}else{t.feedback.canvas.style.display="none"}}},{key:"addFeedback",value:function L(t,e,r,i){var n=this;if(i.isCurve)return;b(""+e!=="NaN");e+=i.x*this.world.zoom;r+=i.y*this.world.zoom;if(i.isBlock){i.parts.forEach(function(i){return n.addFeedback(t,e,r,i)});if(i.bubble.isBlob){this.addFeedback(t,e,r,i.blob)}}if(i.isSource){this.addFeedback(t,e,r,i.blob)}var a=t.dragScript.x;var s=t.dragScript.y;var o=false;if(t.dragScript.isBubble&&i.isBlob&&i.target===t.dragScript.target){a+=t.dragScript.width/2;o=true}else if(i.isInput||i.isSwitch){if(t.dragScript.isBlock){o=t.dragScript.outputs.length===1&&t.dragScript.bubble.isBubble}else if(t.dragScript.isBubble){o=t.dragScript.target!==i.parent}else{o=true}}else if(i.isBubble){if(t.dragScript.isBlock){o=i.isInside&&t.dragScript===i.target&&t.dragScript.outputs.length===1}}if(o){var u=e-a;var l=r-s;var h=u*u+l*l;if(Math.abs(u)>this.feedbackRange||Math.abs(l)>this.feedbackRange||h>t.feedbackDistance)return;t.feedbackDistance=h;t.feedbackInfo={x:e,y:r,obj:i}}}},{key:"renderFeedback",value:function N(t){var e="#ffa";var r=t.feedbackInfo;var i=t.feedback;var n=t.feedback.canvas;var a=this.feedbackLineWidth;var s=a/2;var a=6;var o=r.x-a;var u=r.y-a;var l=r.obj.width*this.world.zoom;var h=r.obj.height*this.world.zoom;n.width=l+a*2;n.height=h+a*2;i.translate(a,a);var c=this.world.zoom;i.scale(c,c);r.obj.pathShadowOn(i);i.lineWidth=a/1;i.lineCap="round";i.lineJoin="round";i.strokeStyle=e;i.stroke();i.globalCompositeOperation="destination-out";i.beginPath();r.obj.pathShadowOn(i);i.fill();i.globalCompositeOperation="source-over";i.globalAlpha=.7;i.fillStyle=e;i.fill();n.style.transform="translate("+o+"px,"+u+"px)"}},{key:"isApp",get:function Y(){return true}},{key:"app",get:function X(){return this}},{key:"feedbackRange",get:function H(){return 26*this.world.zoom}}]);return t}();window.app=new ft;window.onbeforeunload=function(t){return"AAAAA"}},{"./compile":4,"./eval":5,"./events":6,"./prims":8,tinycolor2:3}],8:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.typeOf=r.bySpec=r.functions=r.specs=r.literal=undefined;var i=function(){function t(t,e){var r=[];var i=true;var n=false;var a=undefined;try{for(var s=t[Symbol.iterator](),o;!(i=(o=s.next()).done);i=true){r.push(o.value);if(e&&r.length===e)break}}catch(u){n=true;a=u}finally{try{if(!i&&s["return"])s["return"]()}finally{if(n)throw a}}return r}return function(e,r){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol?"symbol":typeof t};var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,r,i){if(r)t(e.prototype,r);if(i)t(e,i);return e}}();var s=t("js-big-integer");var o=t("fraction.js");var u=c(o);var l=t("tinycolor2");var h=c(l);function c(t){return t&&t.__esModule?t:{"default":t}}function f(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function v(t){if(!t)throw"Assertion failed!"}window.BigInteger=s.BigInteger;var d=function(){function t(e,r){f(this,t);this.schema=e;this.values=r}a(t,[{key:"update",value:function e(r){var i=this;var n={};Object.keys(this.values).forEach(function(t){n[t]=i.values[t]});Object.keys(r).forEach(function(t){n[t]=r[t]});return new t(null,n)}},{key:"toJSON",value:function r(){return this.values}}]);return t}();var p=function Y(t,e){f(this,Y);this.name=t;this.symbols=e;this.symbolSet=new Set(e)};var g=new p("Time",["hour","mins","secs"]);var y=new p("Date",["year","month","day"]);var b=new p("Rgb",["red","green","blue"]);var m=new p("Hsv",["hue","sat","val"]);var w=function(){function t(e,r){f(this,t);this.m=+e;this.s=+r||0}a(t,null,[{key:"add",value:function e(r,i){return new t(r.m+i.m,Math.sqrt(r.s*r.s+i.s*i.s))}},{key:"mul",value:function r(e,i){var n=i.m*e.s;var a=e.m*i.s;return new t(e.m*i.m,Math.sqrt(n*n+a*a))}}]);return t}();function k(t){if((typeof t==="undefined"?"undefined":n(t))==="object"){if(t.constructor===Array){return t.map(k)}else{var e={};Object.keys(t).forEach(function(r){e[r]=k(t[r])});return new d(null,e)}}else{return t}}var x=[["Int",/^-?[0-9]+$/,s.BigInteger.parseInt],["Frac",/^-?[0-9]+\/[0-9]+$/,function(t){return new u.default(t)}],["Float",/^[0-9]+(?:\.[0-9]+)?e-?[0-9]+$/,parseFloat],["Float",/^(?:0|[1-9][0-9]*)?\.[0-9]+$/,parseFloat],["Float",/^(?:0|[1-9][0-9]*)\.[0-9]*$/,parseFloat]];var S={};x.forEach(function(t){var e=i(t,3);var r=e[0];var n=e[1];var a=e[2];if(!S[r])S[r]=[];S[r].push([n,a])});var O=r.literal=function X(t,e){t=t===undefined?"":""+t;var r=x;for(var n=0;n<r.length;n++){var a=i(r[n],3);var s=a[0];var o=a[1];var u=a[2];if(o.test(t)){return u(t)}}return""+t};var C=r.specs=[["ring","%s",[]],["hidden","display %s",[]],["ops","literal %s"],["record","record with %fields"],["record","update %o with %fields"],["record","merge %o with %o"],["record","%q of %o",["name"]],["record","table headings: %l %br rows: %l"],["record","%o to JSON"],["record","from JSON %s"],["list","list %exp",["foo","bar","baz"]],["list","range %n to %n",[1,5]],["list","item %n of %l",[1]],["list","%l concat %l"],["list","length of %l",[]],["list","sum %l"],["list","count %l",[]],["list","count %l if %r",[]],["list","keep %r from %l"],["list","for each %l do %r"],["list","combine %l with %r"],["text","join %exp",["Hello ","world"]],["text","join %l with %s",[""," "]],["text","split %s by %s",[""," "]],["text","replace %s with %s in %s",["-","_","fish-cake"]],["math","%n + %n"],["math","%n – %n"],["math","%n × %n"],["math","%n / %n"],["math","%n rem %n"],["math","%n ^ %n",["",2]],["math","round %n"],["math","float %n"],["math","%n ± %n"],["math","mean %n"],["math","stddev %n"],["math","sqrt of %n",[10]],["math","sin of %n",[30]],["math","cos of %n",[60]],["math","tan of %n",[45]],["bool","%s = %s"],["bool","%s < %s"],["bool","%b and %b"],["bool","%b or %b"],["bool","not %b"],["bool","%b"],["bool","%u if %b else %u",["",true]],["bool","repeat %n times: %s",[3,"party"]],["color","%c",[]],["color","color %s",["blue"]],["color","mix %c with %n %% of %c",["",50,""]],["color","brightness of %c",[]],["color","luminance of %c",[]],["color","%c to hex"],["color","%c to rgb"],["color","%c to hsv"],["color","spin %c by %n"],["color","analogous colors %c"],["color","triad colors %c"],["color","monochromatic colors %c"],["color","invert %c"],["color","complement %c"],["sensing","get %s",["https://tjvr.org/"]],["sensing","get %s",["http://i.imgur.com/svIp9cx.jpg?1"]],["sensing","get %s",["http://api.scratch.mit.edu/users/blob8108"]],["sensing","time"],["sensing","date"]];var F={};C.forEach(function(t){var e=i(t,3);var r=e[0];var n=e[1];var a=e[2];var s=n.split(" ").map(function(t){return t==="%%"?"%":t==="%br"?"BR":/^%/.test(t)?"_":t}).join(" ");F[s]=n});var E=function H(){f(this,H)};var T=function q(t,e,r){f(this,q);this.category=t;this.words=e;this.defaults=r};var _=function z(t,e,r){f(this,z)};function P(t,e){return["text","view-"+t,e||""]}function I(t,e){if(t&&t.isTask){t.withEmit(function(){return e(t.result)})}else{e(t)}}var M=r.functions={"UI <- display Error":function W(t){return P("Error",t.message||t)},"UI <- display Text":function U(t){return P("Text",t)},"UI <- display Int":function J(t){return P("Int",""+t)},"UI <- display Float":function V(t){var e=""+t;var r=e.indexOf(".");if(r===-1){e+="."}else if(r!==-1&&!/e/.test(e)){if(e.length-r>3){e=t.toFixed(3)}}return P("Float",e)},"UI <- display Frac":function K(t){return["block",[P("Frac-num",""+t.n),["rect","#000","auto",2],P("Frac-den",""+t.d)]]},"UI <- display Bool":function $(t){var e=t?"yes":"no";return P("Symbol view-Bool-"+e,e)},"UI Future <- display Record":function Z(t){var e=this;var r=t.schema;var i=r?r.symbols:Object.keys(t.values);var n=[];var a=["table",n];if(r){a=["block",[["text","record-title",r.name,"auto"],a]]}i.forEach(function(r,i){var s=["cell","field",["text","ellipsis",". . ."]];var o=["row","field",i,[["text","field-name",r],["text","field-sym","→"],s]];n.push(o);I(t.values[r],function(t){var r=e.evaluator.getPrim("display %s",[t]);var i=r.func.call(e,t);s[2]=i;e.emit(a)})});this.emit(a);return a},"UI Future <- display List":function G(t){var e=this;var r=[];var i=["table",r];var n=["text","ellipsis",". . ."];if(t.length===0){this.emit(i);return i}I(t[0],function(a){var s=false;if(a instanceof d){var o=a.schema;var u=o?o.symbols:Object.keys(a.values);var l=u.map(function(t){return["cell","header",["text","heading",t],t]});r.push(["row","header",null,l]);s=true}t.forEach(function(t,a){var o=N(t);if(s&&/Record/.test(o)){r.push(["row","record",a,[n]]);I(t,function(t){var n=u.map(function(r){var i=t.values[r];var n=e.evaluator.getPrim("display %s",[i]);return["cell","record",n.func.call(e,i),r]});r[a+1]=["row","record",a,n];e.emit(i)})}else if(/List$/.test(o)){r.push(["row","list",a,[n]]);I(t,function(t){var i=t.map(function(t,r){var i=e.evaluator.getPrim("display %s",[t]);return["cell","list",i.func.call(e,t),r+1]});r[a]=["row","list",a,i]})}else{r.push(["row","item",a,[n]]);I(t,function(t){var i=e.evaluator.getPrim("display %s",[t]);var n=["cell","item",i.func.call(e,t)];r[s?a+1:a]=["row","item",a,[n]]})}})});this.emit(i);return i},"UI <- display Image":function Q(t){return["image",t.cloneNode()]},"UI <- display Color":function tt(t){return["rect",t.toHexString(),24,24,"view-Color"]},"UI <- display Uncertain":function et(t){return["inline",[P("Uncertain-mean",t.m),P("Uncertain-sym","±"),P("Uncertain-stddev",t.s)]]},"Int <- Int + Int":s.BigInteger.add,"Int <- Int – Int":s.BigInteger.subtract,"Int <- Int × Int":s.BigInteger.multiply,"Int <- Int rem Int":s.BigInteger.remainder,"Int <- round Int":function rt(t){return t},"Bool <- Int = Int":function it(t,e){return s.BigInteger.compareTo(t,e)===0},"Bool <- Int < Int":function nt(t,e){return s.BigInteger.compareTo(t,e)===-1},"Frac <- Int / Int":function at(t,e){return new u.default(t,e)},"Float <- float Int":function st(t){return+t.toString()},"Frac <- Frac + Frac":function ot(t,e){return t.add(e)},"Frac <- Frac – Frac":function ut(t,e){return t.sub(e)},"Frac <- Frac × Frac":function lt(t,e){return t.mul(e)},"Frac <- Frac / Frac":function ht(t,e){return t.div(e)},"Float <- float Frac":function ct(t){return t.n/t.d},"Int <- round Frac":function ft(t){return s.BigInteger.parseInt(""+Math.round(t.n/t.d))},"Float <- Float + Float":function vt(t,e){return t+e},"Float <- Float – Float":function dt(t,e){return t-e},"Float <- Float × Float":function pt(t,e){return t*e},"Float <- Float / Float":function gt(t,e){return t/e},"Float <- Float rem Float":function yt(t,e){return(t%e+e)%e},"Int <- round Float":function bt(t){return s.BigInteger.parseInt(""+Math.round(t))},"Float <- float Float":function mt(t){return t},"Bool <- Float = Float":function wt(t,e){return t===e},"Bool <- Float < Float":function kt(t,e){return t<e},"Float <- sqrt of Float":function xt(t){return Math.sqrt(t)},"Float <- sin of Float":function St(t){return Math.sin(Math.PI/180*t)},"Float <- cos of Float":function Ot(t){return Math.sin(Math.PI/180*t)},"Float <- tan of Float":function Ct(t){return Math.sin(Math.PI/180*t)},"Uncertain <- Float ± Float":function Ft(t,e){return new w(t,e)},"Int <- round Uncertain":function Et(t){return t.m|0},"Float <- float Uncertain":function Tt(t){return t.m},"Bool <- Uncertain = Uncertain":function _t(t,e){return t.m===e.m&&t.s===e.s},"Uncertain <- mean List":function Pt(t){if(!t.length)return;var e=0;var r=0;var i=t.length;var n;for(var a=i;a--;){var s=t[a];if(s&&s.constructor===w){n=n||0;s=s.m}e+=s;r+=s*s}var o=e/i;var u=r/(i-1)-o*o;return new w(o,Math.sqrt(u))},"Float <- mean Uncertain":function It(t){return t.m},"Float <- stddev Uncertain":function Mt(t){return t.s},"Uncertain <- Uncertain + Uncertain":w.add,"Uncertain <- Uncertain × Uncertain":w.mul,"Bool <- Bool and Bool":function At(t,e){return t&&e},"Bool <- Bool or Bool":function jt(t,e){return t||e},"Bool <- not Bool":function Rt(t){return!t},"Bool <- Bool":function Bt(t){return!!t},"Bool <- Bool = Bool":function Dt(t,e){return t===e},"Any Future <- Uneval if Bool else Uneval":function Lt(t,e,r){var i=this;var n=e?r:t;var a=e?t:r;if(n)n.unsubscribe(this.target);if(a)a.subscribe(this.target);var s=a.request();this.awaitAll(s.isTask?[s]:[],function(){var t=s.isTask?s.result:s;i.emit(t);i.isRunning=false})},"List <- repeat Int times: Any":function Nt(t,e){var r=[];for(var i=0;i<t;i++){r.push(e)}return r},"Text <- repeat Int times: Text":function Yt(t,e){var r="";for(var i=0;i<t;i++){r+=e}return r},"Text <- literal Text":function Xt(t){return t},"Int <- literal Int":function Ht(t){return t},"Frac <- literal Frac":function qt(t){return t},"Float <- literal Float":function zt(t){return t},"Bool <- Text = Text":function Wt(t,e){return t===e},"Text <- join Variadic":function Ut(){var t=[];var e=[];var r;for(var i=arguments.length,n=Array(i),a=0;a<i;a++){n[a]=arguments[a]}for(var s=0;s<n.length;s++){var o=n[s];if(o&&o.constructor===Array){t.push(o);e.push(s);if(r===undefined){r=o.length}else if(r!==o.length){return new Error("Lists must be same length")}}}if(!t.length){return n.join("")}var u=this.evaluator.getPrim("join %exp",n);var l=this.constructor;var h=[];for(var c=0;c<r;c++){for(var f=0;f<e.length;f++){var s=e[f];n[s]=t[f][c]}h.push(l.fake(u,n.slice()))}this.awaitAll(h,function(){});return h},"Text <- join List with Text":function Jt(t,e){return t.join(e)},"Text List <- split Text by Text":function Vt(t,e){return t.split(e)},"Text <- replace Text with Text in Text":function Kt(t,e,r){
return r.replace(t,e)},"List <- list Variadic":function $t(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++){e[r]=arguments[r]}return e},"List <- List concat List":function Zt(t,e){return t.concat(e)},"List <- range Int to Int":function Gt(t,e){var r=[];for(var i=t;i<=e;i++){r.push(i)}return r},"Any Future <- item Int of List":function Qt(t,e){var r=this;var i=e[t-1];if(i&&i.isTask){this.awaitAll([i],function(){r.emit(i.result)})}else{this.emit(i)}},"Int <- sum List":function te(t){},"Int <- length of List":function ee(t){return t.length},"Int <- count List":function re(t){return t.filter(function(t){return!!t}).length},"Record <- record with Variadic":function ie(){var t={};for(var e=0;e<arguments.length;e+=2){var r=arguments.length<=e+0?undefined:arguments[e+0],i=arguments.length<=e+1+0?undefined:arguments[e+1+0];t[r]=i}return new d(null,t)},"Record <- update Record with Variadic":function ne(t){var t=t||new d(null,{});if(!(t instanceof d))return;var e={};for(var r=0;r<arguments.length-1;r+=2){var i=arguments.length<=r+1?undefined:arguments[r+1],n=arguments.length<=r+1+1?undefined:arguments[r+1+1];e[i]=n}var a=t.update(e);return a},"Record <- merge Record with Record":function ae(t,e){return t.update(e.values)},"Any <- Text of Record":function se(t,e){if(!(e instanceof d))return;return e.values[t]},"Record Future <- table headings: List BR rows: List":function oe(t,e){var r=this;var i=[];var n=false;e.forEach(function(e,a){i.push(null);I(e,function(e){var s={};for(var o=0;o<t.length;o++){var u=t[o];s[u]=e[o]}i[a]=new d(null,s);if(n)r.emit(i)})});this.emit(i);n=true},"Text <- Any to JSON":function ue(t){return JSON.stringify(t)},"Text <- List to JSON":function le(t){return JSON.stringify(t)},"Text <- Record to JSON":function he(t){return JSON.stringify(t)},"Record <- from JSON Text":function ce(t){try{var e=JSON.parse(t)}catch(r){return new Error("Invalid JSON")}return k(e)},"Bool <- Color = Color":h.default.equals,"Color <- Color":function fe(t){return t},"Color <- color Color":function ve(t){return t},"Color <- color Text":function de(t){var e=(0,h.default)(t);if(!e.isValid())return;return e},"Color <- color Rgb":function pe(t){var e=t.values;var r=(0,h.default)({r:e.red,g:e.green,b:e.blue});if(!r.isValid())return;return r},"Color <- color Hsv":function ge(t){var e=t.values;var r=(0,h.default)({h:e.hue,s:e.sat,v:e.val});if(!r.isValid())return;return r},"Color <- mix Color with Float % of Color":function ye(t,e,r){return h.default.mix(t,r,e)},"Float <- brightness of Color":function be(t){return t.getBrightness()},"Float <- luminance of Color":function me(t){return t.getLuminance()},"Color <- spin Color by Int":function we(t,e){return t.spin(e)},"Color <- complement Color":function ke(t){return t.complement()},"Color <- invert Color":function xe(t){var e=t.toRgb();var r=e.r;var i=e.g;var n=e.b;return(0,h.default)({r:255-r,g:255-i,b:255-n})},"Record <- Color to hex":function Se(t){return t.toHexString()},"Record <- Color to rgb":function Oe(t){var e=t.toRgb();return new d(b,{red:e.r,green:e.g,blue:e.b})},"Record <- Color to hsv":function Ce(t){var e=t.toHsv();return new d(m,{hue:e.h,sat:e.s,val:e.v})},"List <- analogous colors Color":function Fe(t){return t.analogous()},"List <- triad colors Color":function Ee(t){return t.triad()},"List <- monochromatic colors Color":function Te(t){return t.monochromatic()},"WebPage Future <- get Text":function _e(t){var e=this;var r="http://localhost:1337/";t=r+t.replace(/^https?\:\/\//,"");var i=new XMLHttpRequest;i.open("GET",t,true);i.onprogress=function(t){e.progress(t.loaded,t.total,t.lengthComputable)};i.onload=function(){if(i.status===200){var t={contentType:i.getResponseHeader("content-type"),response:i.response};var r=t.contentType.split(";")[0];var n=t.response;if(/^image\//.test(r)){var a=new Image;a.addEventListener("load",function(t){e.emit(a)});a.src=URL.createObjectURL(n)}else if(r==="application/json"||r==="text/json"){var s=new FileReader;s.onloadend=function(){try{var t=JSON.parse(s.result)}catch(r){e.emit(new Error("Invalid JSON"));return}e.emit(k(t))};s.onprogress=function(t){};s.readAsText(n)}else if(/^text\//.test(r)){var s=new FileReader;s.onloadend=function(){e.emit(s.result)};s.onprogress=function(t){};s.readAsText(n)}else{e.emit(new Error("Unknown content type: "+r))}}else{e.emit(new Error("HTTP "+i.status+": "+i.statusText))}};i.onerror=function(){e.emit(new Error("XHR Error"))};i.responseType="blob";setTimeout(i.send.bind(i))},"Time Future <- time":function Pe(){var t=this;var e=function i(){if(t.isStopped){clearInterval(r);return}var e=new Date;t.emit(new d(g,{hour:e.getHours(),mins:e.getMinutes(),secs:e.getSeconds()}));t.target.invalidateChildren()};var r=setInterval(e,1e3);e()},"Date Future <- date":function Ie(){var t=this;var e=function i(){if(t.isStopped){clearInterval(r);return}var e=new Date;t.emit(new d(y,{year:e.getFullYear(),month:e.getMonth(),day:e.getDate()}));t.target.invalidateChildren()};var r=setInterval(e,1e3);e()},"Bool <- Time < Time":function Me(t,e){var r=t.values;var i=e.values;return r.hour<i.hour&&r.mins<i.mins&&r.secs<i.secs},"Bool <- Date < Date":function Ae(t,e){var r=t.values;var i=e.values;return r.year<i.year&&r.month<i.month&&r.day<i.day}};var A={"Text <- Int":function je(t){return t.toString()},"Text <- Frac":function Re(t){return t.toString()},"Text <- Float":function Be(t){return t.toFixed(2)},"Text <- Empty":function De(t){return""},"Float <- Text":function Le(t){return+t},"List <- Empty":function Ne(t){return[]},"Frac <- Int":function Ye(t){return new u.default(t,1)},"Float <- Int":function Xe(t){return+t.toString()},"Bool <- List":function He(t){return!!t.length},"Any <- Int":function qe(t){return t},"Any <- Frac":function ze(t){return t},"Any <- Float":function We(t){return t},"Any <- Bool":function Ue(t){return t},"Any <- Empty":function Je(t){return t},"Any <- Text":function Ve(t){return t},"Any <- Image":function Ke(t){return t},"Any <- Uncertain":function $e(t){return t},"Any <- Record":function Ze(t){return t},"Any <- Time":function Ge(t){return t},"Any <- Date":function Qe(t){return t},"List <- Record":j,"List <- Time":j,"List <- Date":j,"Record <- Time":function tr(t){return t},"Record <- Date":function er(t){return t},"Record <- Rgb":function rr(t){return t},"Record <- Hsv":function ir(t){return t},"Uncertain <- Int":function nr(t){return new w(t.toString())},"Uncertain <- Frac":function ar(t){return new w(t.n/t.d)},"Uncertain <- Float":function sr(t){return new w(t)}};function j(t){var e=t.schema;var r=t.values;var i=e?e.symbols:Object.keys(r);return i.map(function(t){return r[t]})}var R={};Object.keys(A).forEach(function(t){var e=B(t);v(e.inputs.length===1);var r=e.inputs[0];var i=e.output;var n=R[i]=R[i]||[];n.push([r,A[t]])});function B(t){var e=t.split(/([A-Za-z:]+|[()]|<-)|\s+/g).filter(function(t){return!!t});var r=e[0];var i=0;function n(){r=e[++i]}function a(){return e[i+1]}var s=function l(t){return/^[A-Z_][a-z]+/.test(t)};function o(){var t=[];while(r&&r!=="<-"){t.push(r);n()}var e=t.join(" ");v(r==="<-");n();var t=[];var i=[];while(r){if(r==="("||s(r)){var a=u();v(a);i.push(a);t.push("_")}else{t.push(r);n()}}var o=t.join(" ");var l=F[o];if(!l)throw o;return{spec:l,inputs:i,output:e}}function u(){if(s(r)){var t=r;n();v(t);return t}else if(r==="("){n();var e=[];while(r!==")"){if(r==="<-"){e=[e];e.push("<-");n();var t=u();v(t);e.push(t);break}else if(r==="*"){e.push("*");n();break}var t=u();v(t);e.push(t)}v(r===")");n();return e}}return o()}var D={};function L(t){if(t.length===0){return[{inputs:[],coercions:[]}]}t=t.slice();var e=t.pop();var r=L(t);var n=[];r.forEach(function(t){var r=t.inputs;var a=t.coercions;n.push({inputs:r.concat([e]),coercions:a.concat([null])});var s=R[e]||[];s.forEach(function(t){var e=i(t,2);var s=e[0];var o=e[1];n.push({inputs:r.concat([s]),coercions:a.concat([o])})})});return n}Object.keys(M).forEach(function(t){var e=B(t);var r=D[e.spec]=D[e.spec]||{};L(e.inputs).forEach(function(i,n){var a=i.inputs;var s=i.coercions;var o=a.join(", ");o=/Variadic/.test(o)?"Variadic":o;if(r[o]&&n>0){return}r[o]={inputs:a,output:e.output,func:M[t],coercions:s}})});r.bySpec=D;var N=r.typeOf=function or(t){if(t===undefined)return"";if(t===null)return"";switch(typeof t==="undefined"?"undefined":n(t)){case"number":if(/^-?[0-9]+$/.test(""+t))return"Int";return"Float";case"string":if(t==="")return"Empty";return"Text";case"boolean":return"Bool";case"object":if(t.isObservable)return"Uneval";if(t.isTask){if(t.isDone){return or(t.result)}return t.prim?""+t.prim.output:"Future"}switch(t.constructor){case Error:return"Error";case s.BigInteger:return"Int";case Array:return"List";case Image:return"Image";case w:return"Uncertain";case d:return t.schema?t.schema.name:"Record"}if(t instanceof u.default)return"Frac";if(t instanceof h.default)return"Color"}throw"Unknown type: "+t};console.log(D)},{"fraction.js":1,"js-big-integer":2,tinycolor2:3}]},{},[7]);